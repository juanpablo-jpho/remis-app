"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[562],{2562:(Ne,T,f)=>{f.r(T),f.d(T,{AuthModule:()=>Ae});var y=f(177),_=f(6217),d=f(467),e=f(3953),v=f(6335),k=f(6114),S=f(9146),L=f(5312),U=f(5083);const I=(0,U.F3)("Browser",{web:()=>f.e(786).then(f.bind(f,4786)).then(i=>new i.BrowserWeb)});var b=f(7600);let j=(()=>{class i{constructor(){this.auth=(0,e.WQX)(v.Nj),this.authState=(0,v.wh)(this.auth),this.firestoreService=(0,e.WQX)(S.B),this.auth.languageCode="es"}createUser(t,o){var n=this;return(0,d.A)(function*(){const a=yield(0,v.eJ)(n.auth,t,o);return yield n.sendEmailVerification(),a})()}getCurrentUser(){return this.auth.currentUser}updateProfile(t){return(0,v.r7)(this.auth.currentUser,t)}updateEmail(t){return(0,v.Ww)(this.auth.currentUser,t)}verifyBeforeUpdateEmail(t){return(0,v.g0)(this.auth.currentUser,t)}reauthenticateWithCredential(t){const o=k.HF.credential(null,t);return(0,v.kZ)(this.auth.currentUser,o)}sendEmailVerification(){return(0,v.gA)(this.auth.currentUser)}updatePassword(t){return(0,v.f3)(this.auth.currentUser,t)}sendPasswordResetEmail(t){return(0,v.J1)(this.auth,t)}login(t,o){var n=this;return(0,d.A)(function*(){return(0,v.x9)(n.auth,t,o)})()}logout(t=!0){var o=this;return(0,d.A)(function*(){yield(0,v.CI)(o.auth),t&&window.location.reload()})()}deleteUser(){return(0,v.hG)(this.auth.currentUser)}loginWithProvider(t){let o;"google"==t&&(o=new k.HF),"apple"==t&&(o=new k.LD("apple.com")),"facebook"==t&&(o=new k.sk),o&&(0,v.$2)(this.auth,o)}getTokenOfProvider(t){var o=this;return(0,d.A)(function*(){return console.log("getTokenOfProvider -> ",t),new Promise(function(){var n=(0,d.A)(function*(a){try{const s=b.B.Auth.PathIntentsLogin,c={provider:t,token:null},m=yield o.firestoreService.createDocument(s,c),g=o.firestoreService.getDocumentChanges(`${s}/${m}`).subscribe(function(){var F=(0,d.A)(function*(C){C&&C.provider==t&&C.token&&(console.log("login with token -> ",C),I.close(),g.unsubscribe(),o.firestoreService.deleteDocument(`${s}/${m}`),a(C.token))});return function(C){return F.apply(this,arguments)}}()),p=`https://${L.c.firebaseConfig.authDomain}/user/request-login?provider=${t}&intentId=${m}`;console.log("link -> ",p),yield I.open({url:p})}catch(s){console.log("getTokenOfProvider -> ",s),a(null)}});return function(a){return n.apply(this,arguments)}}())})()}loginWithTokenOfProvider(t,o){var n=this;return(0,d.A)(function*(){let a;switch(t){case"google":a=k.HF.credential(o);break;case"apple":a=new k.LD("apple.com").credential({idToken:o});break;case"facebook":a=k.sk.credential(o)}return a?yield(0,v.eN)(n.auth,a):null})()}getRedirectResult(){return(0,v.Q4)(this.auth)}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var l=f(4341),R=f(9826),r=f(4388);const N=["modalRecuperarPassword"],X=(i,u)=>({"--background":i,"--color":u}),$=()=>["/user/registro"],D=()=>[0,.75];function G(i,u){if(1&i){const t=e.RV6();e.j41(0,"ion-row",9)(1,"ion-col",10)(2,"ion-button",11),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.loginWithProvider(n))}),e.EFF(3),e.nrm(4,"ion-icon",12),e.k0s()()()}if(2&i){const t=u.$implicit;e.R7$(2),e.Y8G("ngStyle",e.l_i(3,X,t.color,t.textColor)),e.R7$(),e.SpI(" ",t.name," "),e.R7$(),e.Y8G("name",t.icon)}}function M(i,u){if(1&i&&(e.j41(0,"ion-grid",7),e.Z7z(1,G,5,6,"ion-row",9,e.Vm6),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Dyx(t.providers)}}function V(i,u){if(1&i){const t=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Reestablecer contrase\xf1a"),e.k0s(),e.j41(4,"ion-buttons",17)(5,"ion-button",29),e.bIt("click",function(){e.eBV(t),e.XpG();const n=e.sdS(30);return e.Njj(n.dismiss())}),e.nrm(6,"ion-icon",30),e.k0s()()()(),e.j41(7,"ion-content",31)(8,"ion-item",32),e.nrm(9,"ion-icon",33),e.j41(10,"ion-label"),e.EFF(11," Te enviaremos un email a tu correo para que puedas reestablecer tu contrase\xf1a "),e.k0s()(),e.j41(12,"form",14),e.bIt("ngSubmit",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.resetPassword())}),e.nrm(13,"br")(14,"ion-input",34)(15,"br"),e.j41(16,"div",18)(17,"ion-button",19),e.EFF(18," Enviar correo "),e.k0s()()()()}if(2&i){const t=e.XpG(2);e.R7$(12),e.Y8G("formGroup",t.reestablecerPasswordForm)}}function W(i,u){if(1&i){const t=e.RV6();e.j41(0,"ion-grid",8)(1,"ion-row",9)(2,"ion-col",13)(3,"form",14),e.bIt("ngSubmit",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.loginWithEmail())}),e.nrm(4,"br")(5,"ion-input",15)(6,"br"),e.j41(7,"ion-input",16),e.nrm(8,"ion-input-password-toggle",17),e.k0s(),e.nrm(9,"br"),e.j41(10,"div",18)(11,"ion-button",19),e.EFF(12," Ingresar "),e.k0s()()()()(),e.j41(13,"ion-row",9)(14,"ion-col",20)(15,"ion-list",21)(16,"ion-item",22)(17,"ion-label"),e.EFF(18,"\xbfOlvidaste tu contrase\xf1a?"),e.k0s(),e.j41(19,"ion-buttons",17)(20,"ion-button",23),e.EFF(21," Recuperar "),e.k0s()()(),e.nrm(22,"br"),e.j41(23,"ion-item",24)(24,"ion-label"),e.EFF(25,"\xbfNo tienes un usuario?"),e.k0s(),e.j41(26,"ion-buttons",17)(27,"ion-button",25),e.EFF(28," Reg\xedstrate "),e.k0s()()()()()(),e.j41(29,"ion-modal",26,0),e.DNE(31,V,19,1,"ng-template"),e.k0s(),e.j41(32,"ion-row",9)(33,"ion-col",10)(34,"ion-button",27),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.enableLoginWithEmailAndPassword=!1)}),e.EFF(35," Iniciar sesi\xf3n con otro m\xe9todo "),e.nrm(36,"ion-icon",28),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(3),e.Y8G("formGroup",t.loginForm),e.R7$(20),e.Y8G("routerLink",e.lJ4(4,$)),e.R7$(6),e.Y8G("initialBreakpoint",.75)("breakpoints",e.lJ4(5,D))}}let z=(()=>{class i{constructor(t,o,n){this.fb=t,this.router=o,this.interactionService=n,this.authenticationService=(0,e.WQX)(j),this.cargando=!1,this.enableLoginWithEmailAndPassword=!1,this.datosForm=this.fb.group({email:["",[l.k0.required,l.k0.email]]}),this.loginForm=this.fb.group({email:["",[l.k0.required,l.k0.email]],password:["",[l.k0.required]]}),this.reestablecerPasswordForm=this.fb.group({email:["",[l.k0.required,l.k0.email]]}),this.providers=[{name:"Iniciar sesi\xf3n con Google",id:"google",color:"#20a3df",textColor:"white",icon:"logo-google"},{name:"Iniciar sesi\xf3n con Apple",id:"apple",color:"black",textColor:"white",icon:"logo-apple"},{name:"Iniciar sesi\xf3n con correo y contrase\xf1a",id:"password",color:"#9e9e9e",textColor:"white",icon:"mail"}]}ngOnInit(){}loginWithProvider(t){var o=this;return(0,d.A)(function*(){if("password"!=t.id)if(U.Ii.isNativePlatform()){yield o.interactionService.showLoading("Procesando...");const n=yield o.authenticationService.getTokenOfProvider(t.id),a=yield o.authenticationService.loginWithTokenOfProvider(t.id,n);o.interactionService.dismissLoading(),a&&(o.interactionService.showToast(`Bienvenido ${a.user.displayName}`),setTimeout(()=>{o.router.navigate(["user","perfil"],{replaceUrl:!0})},200))}else yield o.interactionService.showLoading("Procesando..."),o.authenticationService.loginWithProvider(t.id);else o.enableLoginWithEmailAndPassword=!0})()}resetPassword(){var t=this;return(0,d.A)(function*(){if(t.reestablecerPasswordForm.valid){const o=t.reestablecerPasswordForm.value;t.modalRecuperarPassword.dismiss(),yield t.interactionService.showLoading("Enviando correo..."),console.log("resetPassword valid -> ",o);try{yield t.authenticationService.sendPasswordResetEmail(o.email),t.interactionService.dismissLoading(),t.interactionService.presentAlert("Importente","Te hemos enviado un correo para reestablecer tu contrase\xf1a"),console.log("te hemos enviado un correo para reestablecer tu contrase\xf1a")}catch(n){console.log("resetPassword error -> ",n)}}})()}loginWithEmail(){var t=this;return(0,d.A)(function*(){if(t.loginForm.valid){const o=t.loginForm.value;yield t.interactionService.showLoading("Ingresando...");try{const n=yield t.authenticationService.login(o.email,o.password);t.interactionService.dismissLoading(),t.interactionService.showToast(`Bienvenido ${n.user.displayName}`),setTimeout(()=>{t.router.navigate(["user","perfil"],{replaceUrl:!0})},500)}catch(n){console.log("login error -> ",n),t.interactionService.dismissLoading(),t.interactionService.presentAlert("Error","Credenciales inv\xe1lidas")}}})()}static#e=this.\u0275fac=function(o){return new(o||i)(e.rXU(l.ok),e.rXU(_.Ix),e.rXU(R.y))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["app-login"]],viewQuery:function(o,n){if(1&o&&e.GBs(N,5),2&o){let a;e.mGM(a=e.lsd())&&(n.modalRecuperarPassword=a.first)}},decls:13,vars:2,consts:[["modalRecuperarPassword",""],["translucent","true"],["slot","start"],["defaultHref","/"],["fullscreen","true"],["collapse","condense"],["size","large"],["fixed","",1,"content-center"],["fixed",""],[1,"ion-justify-content-center"],["size","10","size-md","6","size-lg","4"],["expand","block","shape","round",3,"click","ngStyle"],["slot","start",3,"name"],["size","11","size-md","6"],[3,"ngSubmit","formGroup"],["type","email","label","Email","placeholder","Email","fill","outline","mode","md","labelPlacement","floating","errorText","Ingresa un email v\xe1lido","formControlName","email"],["type","password","label","Contrase\xf1a","placeholder","Contrase\xf1a","mode","md","fill","outline","labelPlacement","floating","errorText","Este campo es requerido","formControlName","password"],["slot","end"],[1,"ion-text-center"],["type","submit","shape","round"],["size","12","size-md","6"],["inset",""],["detail","","button","","lines","none","color","light"],["type","button","color","secondary","id","modal-recuperar-password"],["detail","","button","","lines","none","color","light",3,"routerLink"],["color","secondary"],["trigger","modal-recuperar-password",3,"initialBreakpoint","breakpoints"],["expand","block","shape","round","color","medium",3,"click"],["slot","start","name","arrow-back"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-padding"],["lines","none"],["name","information-circle","slot","start","color","primary"],["type","email","label","Ingresa tu email","placeholder","Email","fill","outline","mode","md","formControlName","email","labelPlacement","floating","errorText","Ingresa un email v\xe1lido"]],template:function(o,n){1&o&&(e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Login"),e.k0s(),e.j41(4,"ion-buttons",2),e.nrm(5,"ion-back-button",3),e.k0s()()(),e.j41(6,"ion-content",4)(7,"ion-header",5)(8,"ion-toolbar")(9,"ion-title",6),e.EFF(10,"Login"),e.k0s()()(),e.DNE(11,M,3,0,"ion-grid",7)(12,W,37,6,"ion-grid",8),e.k0s()),2&o&&(e.R7$(11),e.vxM(n.enableLoginWithEmailAndPassword?-1:11),e.R7$(),e.vxM(n.enableLoginWithEmailAndPassword?12:-1))},dependencies:[y.B3,_.Wk,l.qT,l.BC,l.cb,l.j4,l.JD,r.W9,r.eU,r.ai,r.BC,r.uz,r.he,r.el,r.QW,r.nf,r.Jm,r.Sb,r.lO,r.ln,r.hU,r.$w,r.Wv,r.iq,r.gf],styles:["span[_ngcontent-%COMP%]{color:red;width:100%;display:flex;margin-bottom:15px}"]})}return i})();var h=f(2107),O=f(1413);let x=(()=>{class i{constructor(){this.storage=(0,e.WQX)(h.wc)}uploadString(t,o,n){const a=(0,h.KR)(this.storage,`${t}/${o}`);(0,h.ls)(a,n).then(s=>{console.log("Uploaded string! -> ",s)})}uploadFile(t,o,n){var a=this;return(0,d.A)(function*(){const s=(0,h.KR)(a.storage,`${t}/${o}`);return yield(0,h.D)(s,n)})()}getDownloadURL(t){const o=(0,h.KR)(this.storage,t);return(0,h.qk)(o)}uploadFileProgress(t,o,n){var a=this;const s=(0,h.KR)(this.storage,`${t}/${o}`),c=(0,h.bp)(s,n),m=new O.B;return c.on("state_changed",g=>{m.next({type:g.state,progress:g.bytesTransferred/g.totalBytes*100})},g=>{m.next({type:"error",error:g.message})},(0,d.A)(function*(){const p={type:"complete",url:yield a.getDownloadURL(s.fullPath),ref:s.fullPath};m.next(p)})),m.asObservable()}listAll(t){const o=(0,h.KR)(this.storage,t);return(0,h._w)(o)}list(t,o=100,n=null){const a=(0,h.KR)(this.storage,t),s={maxResults:o};return n&&(s.pageToken=n),(0,h.p_)(a,s)}fileToUlr(t){return URL.createObjectURL(t)}fileToBase64(t){return new Promise((o,n)=>{const a=new FileReader;a.onload=()=>{o(a.result)},a.readAsDataURL(t)})}getMetadata(t){const o=(0,h.KR)(this.storage,t);return(0,h.yb)(o)}urlToBlob(t){return(0,d.A)(function*(){return(yield fetch(t)).blob()})()}downloadFile(t){var o=this;return(0,d.A)(function*(){console.log("saveFile");const n=(0,h.KR)(o.storage,t),a=yield(0,h.qW)(n);console.log("blob -> ",a);const s=URL.createObjectURL(a),c=document.createElement("a");c.href=s,c.download=n.name,c.click(),c.remove()})()}deleteFile(t){const o=(0,h.KR)(this.storage,t);return(0,h.XR)(o)}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),P=(()=>{class i{constructor(t){this.router=t,this.authenticationService=(0,e.WQX)(j),this.firestoreService=(0,e.WQX)(S.B),this.validateHasProfile=!0,console.log("UserService init"),this.getState()}getState(){return new Promise(t=>{this.login?t(this.user):this.authenticationService.authState.subscribe(o=>{o?(this.user=o,this.login="login",console.log("authState -> ",this.user),this.getRol(),this.validateHasProfile&&this.getUserProfile(o.uid)):(this.user=null,this.login="not-login"),t(this.user)})})}getUserProfile(t){var o=this;return(0,d.A)(function*(){return new Promise(function(){var n=(0,d.A)(function*(a){if(o.userProfile)return void a(o.userProfile);const s=yield o.firestoreService.getDocument(`${b.B.Auth.PathUsers}/${t}`);s.exists()?(o.userProfile=s.data(),a(o.userProfile),o.userProfile.email!=o.user.email&&(console.log("sincronizar email"),o.firestoreService.updateDocument(`${b.B.Auth.PathUsers}/${t}`,{email:o.user.email}))):o.router.navigate(["/user/completar-registro"])});return function(a){return n.apply(this,arguments)}}())})()}isLogin(){var t=this;return new Promise(function(){var o=(0,d.A)(function*(n){console.log("isLogin"),n(!!(yield t.getState()))});return function(n){return o.apply(this,arguments)}}())}getRol(){var t=this;return(0,d.A)(function*(){if(t.roles)return t.roles;if(t.user){const n=(yield t.user.getIdTokenResult(!0)).claims;if(n.roles)return t.roles=n.roles,n.roles}return null})()}static#e=this.\u0275fac=function(o){return new(o||i)(e.KVO(_.Ix))};static#t=this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),E=(()=>{class i{transform(t){return"string"==typeof t&&0==t.search("http")?t:URL.createObjectURL(t)}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275pipe=e.EJ8({name:"filetourl",type:i,pure:!0})}return i})();const Q=()=>["/user/login"];function q(i,u){1&i&&(e.j41(0,"span",25)(1,"i"),e.EFF(2,"Este campo es "),e.j41(3,"strong"),e.EFF(4,"requerido"),e.k0s()()())}function Y(i,u){if(1&i&&(e.j41(0,"div",22),e.nrm(1,"img",26),e.nI1(2,"filetourl"),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("src",e.bMT(2,1,t.datosForm.controls.photo.value),e.B4B)}}let J=(()=>{class i{constructor(t,o,n){this.fb=t,this.router=o,this.interactionService=n,this.authenticationService=(0,e.WQX)(j),this.firestoreService=(0,e.WQX)(S.B),this.storageService=(0,e.WQX)(x),this.userService=(0,e.WQX)(P),this.datosForm=this.fb.group({email:["",[l.k0.required,l.k0.email]],password:["",l.k0.required],name:["",l.k0.required],photo:[null,l.k0.required],age:[null,l.k0.required]}),this.cargando=!1}ngOnInit(){return(0,d.A)(function*(){})()}registrarse(){var t=this;return(0,d.A)(function*(){if(t.cargando=!0,console.log("datosForm -> ",t.datosForm),t.datosForm.valid){const o=t.datosForm.value;console.log("valid -> ",o);try{yield t.interactionService.showLoading("Registrando...");const n=o.photo;t.userService.validateHasProfile=!1;const a=yield t.authenticationService.createUser(o.email,o.password),s=`PhotosPerfil/${a.user.uid}`,c=yield t.storageService.uploadFile(s,n.name,n),m=yield t.storageService.getDownloadURL(c.ref.fullPath);console.log("url -> ",m);let g={displayName:o.name,photoURL:c.ref.fullPath};yield t.authenticationService.updateProfile(g);const p={name:o.name,photo:c.ref.fullPath,age:o.age,id:a.user.uid,email:o.email,roles:{cliente:!0}};console.log("datosUser -> ",p),yield t.firestoreService.createDocument(b.B.Auth.PathUsers,p,a.user.uid),t.interactionService.dismissLoading(),t.interactionService.showToast("Usuario creado con \xe9xito"),console.log("usuario creado con \xe9xito"),t.router.navigate(["/user/perfil"])}catch(n){console.log("registrarse error -> ",n),t.interactionService.presentAlert("Error","Ocurri\xf3 un error, intenta nuevamente")}}t.cargando=!1})()}viewPreview(t){var o=this;return(0,d.A)(function*(){if(t.files.length){const n=t.files;console.log("viewPreview files -> ",n);const a=n.item(0);o.datosForm.controls.photo.setValue(a),console.log("this.datosForm.controls.photo -> ",o.datosForm.controls.photo.value)}})()}download(t){this.storageService.downloadFile(t)}static#e=this.\u0275fac=function(o){return new(o||i)(e.rXU(l.ok),e.rXU(_.Ix),e.rXU(R.y))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["app-registro"]],decls:46,vars:5,consts:[["inputFile",""],["translucent","true"],["slot","start"],["defaultHref","/"],["fullscreen","true","color","light"],["collapse","condense"],["size","large"],["fixed",""],[1,"ion-justify-content-center"],["size","11","size-md","8","size-xl","6"],[3,"ngSubmit","formGroup"],["type","email","placeholder","Email","label","Email","labelPlacement","floating","mode","md","fill","outline","formControlName","email","errorText","Ingresa un email v\xe1lido"],["type","password","placeholder","Contrase\xf1a","label","Contrase\xf1a","labelPlacement","floating","mode","md","fill","outline","formControlName","password","errorText","Debe tener m\xednimo 6 caracteres"],["slot","end"],["type","text","placeholder","Juan","label","Tu nombre de usuario","labelPlacement","floating","mode","md","fill","outline","formControlName","name","errorText","Este campo es requerido"],["type","number","placeholder","20","label","Edad","labelPlacement","floating","mode","md","fill","outline","formControlName","age","errorText","Este campo es requerido"],["type","file","accept","image/*",2,"display","none",3,"change"],["inset","","mode","ios"],["lines","none"],[3,"click"],["slot","icon-only","name","image"],["style","text-align: end;",4,"ngIf"],[1,"ion-text-center"],["type","submit","shape","round"],["color","medium","shape","round",3,"routerLink"],[2,"text-align","end"],[2,"max-width","150px",3,"src"]],template:function(o,n){if(1&o){const a=e.RV6();e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Registrarse"),e.k0s(),e.j41(4,"ion-buttons",2),e.nrm(5,"ion-back-button",3),e.k0s()()(),e.j41(6,"ion-content",4)(7,"ion-header",5)(8,"ion-toolbar")(9,"ion-title",6),e.EFF(10,"Registrarse"),e.k0s()()(),e.j41(11,"ion-grid",7)(12,"ion-row",8)(13,"ion-col",9)(14,"form",10),e.bIt("ngSubmit",function(){return e.eBV(a),e.Njj(n.registrarse())}),e.nrm(15,"br")(16,"ion-input",11)(17,"br"),e.j41(18,"ion-input",12),e.nrm(19,"ion-input-password-toggle",13),e.k0s(),e.nrm(20,"br")(21,"ion-input",14)(22,"br")(23,"ion-input",15)(24,"br"),e.j41(25,"input",16,0),e.bIt("change",function(){e.eBV(a);const c=e.sdS(26);return e.Njj(n.viewPreview(c))}),e.k0s(),e.j41(27,"ion-list",17)(28,"ion-item",18)(29,"ion-label"),e.EFF(30,"Selecciona una foto de perfil"),e.k0s(),e.j41(31,"ion-buttons",13)(32,"ion-button",19),e.bIt("click",function(){e.eBV(a);const c=e.sdS(26);return e.Njj(c.click())}),e.nrm(33,"ion-icon",20),e.k0s()()()(),e.DNE(34,q,5,0,"span",21),e.nrm(35,"br"),e.DNE(36,Y,3,3,"div",22),e.nrm(37,"br"),e.j41(38,"div",22)(39,"ion-button",23),e.EFF(40," Registrarse "),e.k0s()()()()()(),e.j41(41,"div",22)(42,"p"),e.EFF(43," \xbfYa tienes un usuario?"),e.k0s(),e.j41(44,"ion-button",24),e.EFF(45," Ingresar "),e.k0s()()()}2&o&&(e.R7$(14),e.Y8G("formGroup",n.datosForm),e.R7$(20),e.Y8G("ngIf",n.datosForm.controls.photo.hasError("required")),e.R7$(2),e.vxM(null!=n.datosForm&&null!=n.datosForm.controls&&null!=n.datosForm.controls.photo&&n.datosForm.controls.photo.value?36:-1),e.R7$(8),e.Y8G("routerLink",e.lJ4(4,Q)))},dependencies:[y.bT,_.Wk,l.qT,l.BC,l.cb,l.j4,l.JD,r.W9,r.eU,r.ai,r.BC,r.uz,r.he,r.el,r.QW,r.nf,r.Jm,r.lO,r.ln,r.hU,r.$w,r.Wv,r.iq,r.gf,E],styles:["span[_ngcontent-%COMP%]{color:red}img[_ngcontent-%COMP%]{max-width:100px;border-radius:100%}"]})}return i})(),B=(()=>{class i{constructor(){this.storageService=(0,e.WQX)(x)}transform(t){var o=this;return(0,d.A)(function*(){if(t){if(0==t.search("http"))return t;const n=yield o.storageService.getDownloadURL(t);return console.log("transform url -> ",n),n}return""})()}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275pipe=e.EJ8({name:"reftourl",type:i,pure:!0})}return i})();const H=["modalEditInfo"],K=()=>["/"],Z=()=>[0,.75];function ee(i,u){1&i&&(e.j41(0,"div",12)(1,"ion-chip",29),e.nrm(2,"ion-icon",30),e.j41(3,"ion-label"),e.EFF(4,"correo verificado"),e.k0s()()())}function te(i,u){if(1&i){const t=e.RV6();e.j41(0,"div",12)(1,"ion-chip",31),e.nrm(2,"ion-icon",32),e.j41(3,"ion-label"),e.EFF(4,"correo no verificado"),e.k0s()()(),e.j41(5,"ion-list",16)(6,"ion-item",33),e.bIt("click",function(){e.eBV(t);const n=e.XpG(3);return e.Njj(n.enviarCorreo())}),e.nrm(7,"ion-icon",34),e.j41(8,"ion-label"),e.EFF(9,"Enviar correo de verificaci\xf3n"),e.k0s()()()}}function oe(i,u){if(1&i){const t=e.RV6();e.j41(0,"ion-item",10),e.nrm(1,"ion-icon",37),e.j41(2,"ion-label"),e.EFF(3," Ingresa el nuevo correo, te enviaremos un enlace de verificaci\xf3n para que el cambio sea exitoso. "),e.k0s()(),e.j41(4,"form",38),e.bIt("ngSubmit",function(){e.eBV(t);const n=e.XpG(4);return e.Njj(n.actualizarEmail())}),e.nrm(5,"br")(6,"ion-input",39)(7,"br"),e.j41(8,"div",40)(9,"ion-button",41),e.EFF(10," actualizar "),e.k0s()()()}if(2&i){const t=e.XpG(4);e.R7$(4),e.Y8G("formGroup",t.formNewEmail)}}function ne(i,u){if(1&i){const t=e.RV6();e.j41(0,"ion-item",10),e.nrm(1,"ion-icon",37),e.j41(2,"ion-label"),e.EFF(3," Ingresa tu nombre de perfil "),e.k0s()(),e.nrm(4,"br"),e.j41(5,"ion-input",42),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG(4);return e.DH7(a.newName,n)||(a.newName=n),e.Njj(n)}),e.k0s(),e.nrm(6,"br"),e.j41(7,"div",40)(8,"ion-button",43),e.bIt("click",function(){e.eBV(t);const n=e.XpG(4);return e.Njj(n.actualizarPerfil())}),e.EFF(9," actualizar "),e.k0s()()}if(2&i){const t=e.XpG(4);e.R7$(5),e.R50("ngModel",t.newName)}}function ie(i,u){if(1&i&&(e.nrm(0,"img",11),e.nI1(1,"reftourl"),e.nI1(2,"async")),2&i){const t=e.XpG(5);e.Y8G("src",e.bMT(2,3,e.bMT(1,1,t.user.photoURL)),e.B4B)}}function re(i,u){if(1&i&&(e.nrm(0,"img",11),e.nI1(1,"filetourl")),2&i){const t=e.XpG(5);e.Y8G("src",e.bMT(1,1,t.newImage),e.B4B)}}function ae(i,u){if(1&i){const t=e.RV6();e.j41(0,"div",40)(1,"ion-button",43),e.bIt("click",function(){e.eBV(t);const n=e.XpG(5);return e.Njj(n.editarProfilePicture())}),e.EFF(2," actualizar "),e.k0s()()}}function se(i,u){if(1&i){const t=e.RV6();e.j41(0,"input",44,1),e.bIt("change",function(){e.eBV(t);const n=e.sdS(1),a=e.XpG(4);return e.Njj(a.viewPreview(n))}),e.k0s(),e.j41(2,"ion-item")(3,"ion-avatar",3),e.DNE(4,ie,3,5,"img",11)(5,re,2,3,"img",11),e.k0s(),e.j41(6,"ion-buttons",25)(7,"ion-button",26),e.bIt("click",function(){e.eBV(t);const n=e.sdS(1);return e.Njj(n.click())}),e.nrm(8,"ion-icon",19),e.EFF(9," editar "),e.k0s(),e.j41(10,"ion-button",26),e.bIt("click",function(){e.eBV(t);const n=e.XpG(4);return e.Njj(n.downloadProfilePicture())}),e.nrm(11,"ion-icon",45),e.k0s()()(),e.nrm(12,"br"),e.DNE(13,ae,3,0,"div",40)}if(2&i){const t=e.XpG(4);e.R7$(4),e.vxM(t.newImage?5:4),e.R7$(9),e.vxM(t.newImage?13:-1)}}function le(i,u){1&i&&(e.j41(0,"span")(1,"i"),e.EFF(2,"Las contrase\xf1as no "),e.j41(3,"strong"),e.EFF(4,"coinciden"),e.k0s()()())}function ce(i,u){if(1&i){const t=e.RV6();e.j41(0,"ion-item",10),e.nrm(1,"ion-icon",37),e.j41(2,"ion-label"),e.EFF(3," Ingresa una nueva contrase\xf1a, para completar esta acci\xf3n debes haber iniciado sesi\xf3n recientemente "),e.k0s()(),e.nrm(4,"br"),e.j41(5,"form",38),e.bIt("ngSubmit",function(){e.eBV(t);const n=e.XpG(4);return e.Njj(n.cambiarPassword())}),e.j41(6,"ion-input",46),e.nrm(7,"ion-input-password-toggle",25),e.k0s(),e.nrm(8,"br"),e.j41(9,"ion-input",47),e.nrm(10,"ion-input-password-toggle",25),e.k0s(),e.DNE(11,le,5,0,"span",48),e.nrm(12,"br"),e.j41(13,"div",40)(14,"ion-button",41),e.EFF(15," establecer "),e.k0s()()()}if(2&i){const t=e.XpG(4);e.R7$(5),e.Y8G("formGroup",t.formCambiarPassword),e.R7$(),e.Y8G("counter",!0),e.R7$(5),e.Y8G("ngIf",t.formCambiarPassword.controls.repetPassword.hasError("notSame"))}}function ue(i,u){if(1&i){const t=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",25)(5,"ion-button",26),e.bIt("click",function(){e.eBV(t),e.XpG();const n=e.sdS(54);return e.Njj(n.isOpen=!1)}),e.nrm(6,"ion-icon",35),e.k0s()()()(),e.j41(7,"ion-content",36),e.DNE(8,oe,11,1)(9,ne,10,1)(10,se,14,2)(11,ce,16,3),e.k0s()}if(2&i){const t=e.XpG(3);e.R7$(3),e.JRh(t.titleModal),e.R7$(5),e.vxM("email"==t.opcModal?8:-1),e.R7$(),e.vxM("name"==t.opcModal?9:-1),e.R7$(),e.vxM("photo"==t.opcModal?10:-1),e.R7$(),e.vxM("password"==t.opcModal?11:-1)}}function de(i,u){if(1&i){const t=e.RV6();e.j41(0,"ion-list")(1,"ion-list-header",9)(2,"ion-label")(3,"i"),e.EFF(4,"Bienvenido"),e.k0s()()(),e.j41(5,"ion-item",10)(6,"ion-avatar",3),e.nrm(7,"img",11),e.nI1(8,"reftourl"),e.nI1(9,"async"),e.k0s(),e.j41(10,"ion-label"),e.EFF(11),e.j41(12,"p"),e.EFF(13),e.k0s()()()(),e.DNE(14,ee,5,0,"div",12)(15,te,10,0),e.j41(16,"ion-grid",13)(17,"ion-row",14)(18,"ion-col",15)(19,"ion-list",16)(20,"ion-item",17),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.selectOpcModal("email"))}),e.nrm(21,"ion-icon",18),e.j41(22,"ion-label"),e.EFF(23,"Editar correo"),e.k0s()(),e.j41(24,"ion-item",17),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.selectOpcModal("photo"))}),e.nrm(25,"ion-icon",19),e.j41(26,"ion-label"),e.EFF(27,"Editar foto de perfil"),e.k0s()(),e.j41(28,"ion-item",17),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.selectOpcModal("name"))}),e.nrm(29,"ion-icon",20),e.j41(30,"ion-label"),e.EFF(31,"Editar nombre de perfil"),e.k0s()(),e.j41(32,"ion-item",17),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.selectOpcModal("password"))}),e.nrm(33,"ion-icon",21),e.j41(34,"ion-label"),e.EFF(35,"Establecer contrase\xf1a"),e.k0s()(),e.j41(36,"ion-item",17),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.salir())}),e.nrm(37,"ion-icon",22),e.j41(38,"ion-label"),e.EFF(39,"Cerrar sesi\xf3n"),e.k0s()(),e.j41(40,"ion-item",17),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.eliminarCuenta())}),e.nrm(41,"ion-icon",23),e.j41(42,"ion-label"),e.EFF(43,"Eliminar cuenta"),e.k0s()()()()()(),e.j41(44,"ion-list",16)(45,"ion-list-header",9)(46,"ion-label"),e.EFF(47,"Informaci\xf3n"),e.k0s()(),e.j41(48,"ion-item",10)(49,"ion-input",24),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG(2);return e.DH7(a.userProfile.age,n)||(a.userProfile.age=n),e.Njj(n)}),e.k0s(),e.j41(50,"ion-buttons",25)(51,"ion-button",26),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.actualizarEdad())}),e.nrm(52,"ion-icon",27),e.k0s()()()(),e.j41(53,"ion-modal",28,0),e.DNE(55,ue,12,5,"ng-template"),e.k0s(),e.nrm(56,"br")(57,"br")}if(2&i){const t=e.XpG(2);e.R7$(7),e.Y8G("src",e.bMT(9,9,e.bMT(8,7,t.user.photoURL)),e.B4B),e.R7$(4),e.SpI(" ",t.user.displayName," "),e.R7$(2),e.JRh(t.user.email),e.R7$(),e.vxM(t.user.emailVerified?14:15),e.R7$(35),e.R50("ngModel",t.userProfile.age),e.R7$(4),e.Y8G("initialBreakpoint",.75)("breakpoints",e.lJ4(11,Z))}}function me(i,u){if(1&i&&e.DNE(0,de,58,12),2&i){const t=e.XpG();e.vxM(t.user&&t.userProfile?0:-1)}}function pe(i,u){1&i&&(e.nrm(0,"br"),e.j41(1,"div",40),e.nrm(2,"ion-spinner",49),e.k0s())}let fe=(()=>{class i{constructor(t,o,n){this.fb=t,this.router=o,this.interactionService=n,this.authenticationService=(0,e.WQX)(j),this.firestoreService=(0,e.WQX)(S.B),this.userService=(0,e.WQX)(P),this.storageService=(0,e.WQX)(x),this.newName="",this.newPhoto="",this.iniciando=!0,this.formNewEmail=this.fb.group({email:["",[l.k0.required,l.k0.email]]}),this.isSame=a=>(console.log("input -> ",a.value),this.formCambiarPassword?.value?.newPassword!=a?.value?{notSame:!0}:{}),this.formCambiarPassword=this.fb.group({newPassword:["",[l.k0.required,l.k0.minLength(6)]],repetPassword:["",[l.k0.required,this.isSame]]}),this.iniciando=!0,this.user=this.authenticationService.getCurrentUser(),this.getDatosProfile(this.user.uid)}ngOnInit(){}ionViewDidEnter(){const t=this.authenticationService.getCurrentUser();console.log("ionViewDidEnter login -> ",t),t&&(this.user=t)}salir(){this.authenticationService.logout()}actualizarPerfil(){var t=this;return(0,d.A)(function*(){let o={};if(t.newName&&(o.displayName=t.newName),o.displayName){t.modalEditInfo.isOpen=!1,yield t.interactionService.showLoading("Actualizando..."),yield t.authenticationService.updateProfile(o);const n=t.authenticationService.getCurrentUser(),a={name:n.displayName,photo:n.photoURL};yield t.firestoreService.updateDocument(`${b.B.Auth.PathUsers}/${n.uid}`,a),t.interactionService.dismissLoading(),t.interactionService.showToast("Actualizado con \xe9xito"),t.user=n,t.newName=null,t.newPhoto=null}})()}getDatosProfile(t){var o=this;return(0,d.A)(function*(){console.log("getDatosProfile -> ",t),o.firestoreService.getDocumentChanges(`${b.B.Auth.PathUsers}/${t}`).subscribe(n=>{n&&(o.userProfile=n,console.log("this.userProfile -> ",o.userProfile)),o.iniciando=!1})})()}actualizarEdad(){var t=this;return(0,d.A)(function*(){const o=t.authenticationService.getCurrentUser(),n={age:t.userProfile.age};yield t.interactionService.showLoading("Actualizando..."),yield t.firestoreService.updateDocument(`${b.B.Auth.PathUsers}/${o.uid}`,n),console.log("actualizado con \xe9xito"),yield t.interactionService.dismissLoading(),t.interactionService.showToast("Actualizado con \xe9xito")})()}actualizarEmail(){var t=this;return(0,d.A)(function*(){if(t.formNewEmail.valid){const o=t.formNewEmail.value;console.log("valid -> ",o);try{yield t.interactionService.showLoading("Enviando enlace de verificaci\xf3n..."),yield t.authenticationService.verifyBeforeUpdateEmail(o.email),t.interactionService.dismissLoading(),yield t.interactionService.presentAlert("Importante",`Te hemos enviado un correo a <strong>${o.email}</strong> para que puedas verificar tu nuevo correo, \n              verif\xedcalo e inicia sesi\xf3n con el nuevo correo, caso contrario inicia sesi\xf3n con tu correo de siempre`),yield t.authenticationService.logout(!1),t.modalEditInfo.isOpen=!1,setTimeout(()=>{t.router.navigate(["/user/login"])},200)}catch(n){console.log("error al actualizar el correo -> ",n),t.interactionService.dismissLoading(),t.modalEditInfo.isOpen=!1,(yield t.interactionService.presentAlert("Error","Para realizar esta acci\xf3n debes haber realizado un inicio de sesi\xf3n reciente.\n        \xbfDeseas cerrar sesi\xf3n y volver a ingresar para realizar esta acci\xf3n?","Cancelar"))&&(yield t.authenticationService.logout(!1),setTimeout(()=>{t.router.navigate(["/user/login"],{replaceUrl:!0})},200))}}})()}enviarCorreo(){var t=this;return(0,d.A)(function*(){t.interactionService.showLoading("Enviando correo..."),yield t.authenticationService.sendEmailVerification(),t.interactionService.dismissLoading(),yield t.interactionService.presentAlert("Importante","Te hemos enviado un enlace de verificaci\xf3n a tu correo"),console.log("correo enviado -> comprueba tu correo")})()}cambiarPassword(){var t=this;return(0,d.A)(function*(){if(console.log("this.formCambiarPassword -> ",t.formCambiarPassword),t.formCambiarPassword.valid){const o=t.formCambiarPassword.value;console.log("valid -> ",o);try{yield t.interactionService.showLoading("Validando..."),yield t.authenticationService.updatePassword(o.newPassword),t.interactionService.dismissLoading(),t.interactionService.showToast("Contrase\xf1a establecida con \xe9xito"),t.modalEditInfo.isOpen=!1,console.log("contrase\xf1a actualizada con \xe9xito")}catch(n){console.log("error al cambiar la contrase\xf1a -> ",n),t.interactionService.dismissLoading(),(yield t.interactionService.presentAlert("Error","Para establacer una nueva contrase\xf1a debes cerrar tu sesi\xf3n e ingresar nuevamente, <strong>\xbfDeseas cerrar tu sesi\xf3n?</strong>","Cancelar"))&&(yield t.authenticationService.logout(!1),setTimeout(()=>{t.router.navigate(["/user/login"])},200))}}})()}eliminarCuenta(){var t=this;return(0,d.A)(function*(){if(yield t.interactionService.presentAlert("Importante","Seguro que deseas eliminar tu cuenta, <strong>esta acci\xf3n no se puede revertir</strong>","Cancelar"))try{yield t.interactionService.showLoading("Eliminando...");const n=t.authenticationService.getCurrentUser();yield t.authenticationService.updatePassword("xxxxxx"),yield t.firestoreService.deleteDocument(`${b.B.Auth.PathUsers}/${n.uid}`),yield t.authenticationService.deleteUser(),console.log("cuenta eliminada con \xe9xito"),yield t.interactionService.dismissLoading(),yield t.authenticationService.logout(),t.router.navigate(["/user/login"])}catch(n){console.log("error al eliminar la cuenta -> ",n),(yield t.interactionService.presentAlert("Error","Para eliminar tu cuenta debes cerrar tu sesi\xf3n e ingresar nuevamente, <strong>\xbfDeseas cerrar tu sesi\xf3n?</strong>","Cancelar"))&&(yield t.authenticationService.logout(!1),setTimeout(()=>{t.router.navigate(["/user/login"],{replaceUrl:!0})},200))}})()}downloadProfilePicture(){var t=this;return(0,d.A)(function*(){yield t.storageService.downloadFile(t.userProfile.photo),console.log("imagen descargada con \xe9xito")})()}editarProfilePicture(){var t=this;return(0,d.A)(function*(){console.log("subiendo..."),yield t.interactionService.showLoading("Subiendo...");const o=`PhotosPerfil/${t.user.uid}`,n=t.newImage.name,a=yield t.storageService.uploadFile(o,n,t.newImage);yield t.authenticationService.updateProfile({photoURL:a.ref.fullPath});const s={photo:a.ref.fullPath};yield t.firestoreService.updateDocument(`${b.B.Auth.PathUsers}/${t.user.uid}`,s),t.user=t.authenticationService.getCurrentUser(),t.interactionService.dismissLoading(),t.interactionService.showToast("Actualizado con \xe9xito"),t.newImage=null,t.modalEditInfo.isOpen=!1})()}viewPreview(t){var o=this;return(0,d.A)(function*(){t.files.length&&(o.newImage=t.files.item(0))})()}selectOpcModal(t){this.opcModal=t,"email"==this.opcModal&&(this.titleModal="Cambiar correo"),"photo"==this.opcModal&&(this.titleModal="Cambiar foto"),"name"==this.opcModal&&(this.titleModal="Cambiar nombre",this.newName=this.user.displayName),"password"==this.opcModal&&(this.titleModal="Cambiar contrase\xf1a"),this.modalEditInfo.isOpen=!0}static#e=this.\u0275fac=function(o){return new(o||i)(e.rXU(l.ok),e.rXU(_.Ix),e.rXU(R.y))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["app-perfil"]],viewQuery:function(o,n){if(1&o&&e.GBs(H,5),2&o){let a;e.mGM(a=e.lsd())&&(n.modalEditInfo=a.first)}},decls:14,vars:3,consts:[["modalEditInfo",""],["files",""],["translucent","true"],["slot","start"],[3,"routerLink"],["slot","icon-only","name","arrow-back"],["fullscreen","true","color","light"],["collapse","condense"],["size","large"],["mode","ios"],["lines","none"],[3,"src"],[1,"ion-text-end"],["fixed","",1,"ion-no-padding"],[1,"ion-justify-content-center"],["size","12","size-md","8"],["inset",""],["button","",3,"click"],["slot","start","name","mail"],["slot","start","name","image"],["slot","start","name","person"],["slot","start","name","finger-print"],["slot","start","name","log-out"],["slot","start","name","trash","color","danger"],["label","Edad","mode","md","labelPlacement","floating",3,"ngModelChange","ngModel"],["slot","end"],[3,"click"],["slot","icon-only","name","save"],[3,"initialBreakpoint","breakpoints"],["color","success","mode","ios"],["name","checkmark-circle"],["color","danger","mode","ios"],["name","close-circle"],["button","","detail","false","lines","none",3,"click"],["name","send","slot","end"],["slot","icon-only","name","close"],[1,"ion-padding"],["name","information-circle","slot","start","color","primary"],[3,"ngSubmit","formGroup"],["type","email","placeholder","email","label","Nuevo correo","labelPlacement","floating","fill","outline","mode","md","formControlName","email","errorText","Ingresa un correo v\xe1lido"],[1,"ion-text-center"],["type","submit","shape","round"],["label","Nombre","type","text","placeholder","Nombre","fill","outline","mode","md","labelPlacement","floating",3,"ngModelChange","ngModel"],["shape","round",3,"click"],["type","file","accept","image/*",2,"display","none",3,"change"],["slot","icon-only","name","cloud-download"],["type","password","label","Contrase\xf1a","placeholder","Contrase\xf1a","mode","md","fill","outline","labelPlacement","floating","errorText","Debe ser m\xednimo de 6 caracteres","formControlName","newPassword","minlength","6",3,"counter"],["type","password","label","Repita la contrase\xf1a","placeholder","Contrase\xf1a","mode","md","fill","outline","labelPlacement","floating","formControlName","repetPassword"],[4,"ngIf"],["name","bubbles"]],template:function(o,n){1&o&&(e.j41(0,"ion-header",2)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Perfil"),e.k0s(),e.j41(4,"ion-buttons",3)(5,"ion-button",4),e.nrm(6,"ion-icon",5),e.k0s()()()(),e.j41(7,"ion-content",6)(8,"ion-header",7)(9,"ion-toolbar")(10,"ion-title",8),e.EFF(11,"Perfil"),e.k0s()()(),e.DNE(12,me,1,1)(13,pe,3,0),e.k0s()),2&o&&(e.R7$(5),e.Y8G("routerLink",e.lJ4(2,K)),e.R7$(7),e.vxM(n.iniciando?13:12))},dependencies:[y.bT,_.Wk,l.qT,l.BC,l.cb,l.xh,l.vS,l.j4,l.JD,r.W9,r.eU,r.ai,r.BC,r.uz,r.mC,r.he,r.QW,r.nf,r.Jm,r.Sb,r.lO,r.ln,r.hU,r.$w,r.Wv,r.ZB,r.iq,r.w2,r.AF,r.gf,y.Jj,E,B]})}return i})();function ge(i,u){1&i&&(e.j41(0,"span")(1,"i"),e.EFF(2,"Este campo es "),e.j41(3,"strong"),e.EFF(4,"requerido"),e.k0s()()())}function he(i,u){if(1&i&&(e.j41(0,"div",20),e.nrm(1,"img",25),e.nI1(2,"filetourl"),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("src",e.bMT(2,1,t.datosFormCompleteRegistro.controls.photo.value),e.B4B)}}let _e=(()=>{class i{constructor(t,o,n){this.fb=t,this.router=o,this.interactionService=n,this.authenticationService=(0,e.WQX)(j),this.firestoreService=(0,e.WQX)(S.B),this.storageService=(0,e.WQX)(x),this.cargando=!1,this.datosFormCompleteRegistro=this.fb.group({email:["",[l.k0.required,l.k0.email]],name:["",l.k0.required],photo:[null,l.k0.required],age:[null,l.k0.required]}),this.user=this.authenticationService.auth.currentUser,this.datosFormCompleteRegistro.setValue({email:this.user.email,name:this.user.displayName,photo:this.user.photoURL,age:null})}ngOnInit(){}completarRegistro(){var t=this;return(0,d.A)(function*(){if(t.cargando=!0,console.log("datosFormCompleteRegistro -> ",t.datosFormCompleteRegistro),t.datosFormCompleteRegistro.valid){yield t.interactionService.showLoading("Procensando...");const o=t.datosFormCompleteRegistro.value;console.log("valid -> ",o);try{let n=o.photo;if("string"!=typeof o.photo){const m=o.photo,g=`PhotosPerfil/${t.user.uid}`,p=yield t.storageService.uploadFile(g,m.name,m),F=yield t.storageService.getDownloadURL(p.ref.fullPath);console.log("url -> ",F),n=p.ref.fullPath}let a={displayName:o.name,photoURL:n};const s=t.authenticationService.getCurrentUser();yield t.authenticationService.updateProfile(a);const c={name:o.name,photo:n,age:o.age,id:s.uid,email:o.email,roles:{cliente:!0}};console.log("datosUser -> ",c),yield t.firestoreService.createDocument(b.B.Auth.PathUsers,c,s.uid),console.log("completado registro con \xe9xito"),t.interactionService.dismissLoading(),t.interactionService.showToast("Completado registro con \xe9xito"),t.router.navigate(["/user/perfil"])}catch(n){console.log("registrarse error -> ",n),t.interactionService.presentAlert("Error","Ocurri\xf3 un error, intenta nuevamente")}}t.cargando=!1})()}viewPreview(t){var o=this;return(0,d.A)(function*(){if(t.files.length){const n=t.files;console.log("viewPreview files -> ",n);const a=n.item(0);o.datosFormCompleteRegistro.controls.photo.setValue(a),console.log("this.datosFormCompleteRegistro.controls.photo -> ",o.datosFormCompleteRegistro.controls.photo.value)}})()}salir(){this.authenticationService.logout()}static#e=this.\u0275fac=function(o){return new(o||i)(e.rXU(l.ok),e.rXU(_.Ix),e.rXU(R.y))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["app-completar-registro"]],decls:42,vars:3,consts:[["inputFile",""],["translucent","true"],["fullscreen","true","color","light"],["collapse","condense"],["size","large"],["fixed",""],[1,"ion-justify-content-center"],["size","11","size-md","8","size-xl","6"],[3,"ngSubmit","formGroup"],["type","text","label","Email","formControlName","email","readonly","","fill","outline","mode","md","labelPlacement","floating"],["type","text","placeholder","Juan","label","Tu nombre de usuario","labelPlacement","floating","mode","md","fill","outline","formControlName","name","errorText","Este campo es requerido"],["type","number","placeholder","20","label","Edad","labelPlacement","floating","mode","md","fill","outline","formControlName","age","errorText","Este campo es requerido"],["type","file","accept","image/*",2,"display","none",3,"change"],["inset","","mode","ios"],["lines","none"],["slot","end"],[3,"click"],["slot","icon-only","name","image"],[2,"text-align","end"],[4,"ngIf"],[1,"ion-text-center"],["type","submit","shape","round"],["mode","ios"],["button","",3,"click"],["slot","start","name","log-out"],[3,"src"]],template:function(o,n){if(1&o){const a=e.RV6();e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Completar registro"),e.k0s()()(),e.j41(4,"ion-content",2)(5,"ion-header",3)(6,"ion-toolbar")(7,"ion-title",4),e.EFF(8,"Completar registro"),e.k0s()()(),e.j41(9,"ion-grid",5)(10,"ion-row",6)(11,"ion-col",7)(12,"form",8),e.bIt("ngSubmit",function(){return e.eBV(a),e.Njj(n.completarRegistro())}),e.nrm(13,"br")(14,"ion-input",9)(15,"br")(16,"ion-input",10)(17,"br")(18,"ion-input",11)(19,"br"),e.j41(20,"input",12,0),e.bIt("change",function(){e.eBV(a);const c=e.sdS(21);return e.Njj(n.viewPreview(c))}),e.k0s(),e.j41(22,"ion-list",13)(23,"ion-item",14)(24,"ion-label"),e.EFF(25,"Selecciona una foto de perfil"),e.k0s(),e.j41(26,"ion-buttons",15)(27,"ion-button",16),e.bIt("click",function(){e.eBV(a);const c=e.sdS(21);return e.Njj(c.click())}),e.nrm(28,"ion-icon",17),e.k0s()()()(),e.j41(29,"div",18),e.DNE(30,ge,5,0,"span",19),e.k0s(),e.nrm(31,"br"),e.DNE(32,he,3,3,"div",20),e.nrm(33,"br"),e.j41(34,"div",20)(35,"ion-button",21),e.EFF(36," Completar registro "),e.k0s()()(),e.j41(37,"ion-card",22)(38,"ion-item",23),e.bIt("click",function(){return e.eBV(a),e.Njj(n.salir())}),e.nrm(39,"ion-icon",24),e.j41(40,"ion-label"),e.EFF(41,"Cerrar sesi\xf3n"),e.k0s()()()()()()()}2&o&&(e.R7$(12),e.Y8G("formGroup",n.datosFormCompleteRegistro),e.R7$(18),e.Y8G("ngIf",n.datosFormCompleteRegistro.controls.photo.hasError("required")),e.R7$(2),e.vxM(null!=n.datosFormCompleteRegistro&&null!=n.datosFormCompleteRegistro.controls&&null!=n.datosFormCompleteRegistro.controls.photo&&n.datosFormCompleteRegistro.controls.photo.value?32:-1))},dependencies:[y.bT,l.qT,l.BC,l.cb,l.j4,l.JD,r.W9,r.eU,r.ai,r.BC,r.uz,r.he,r.b_,r.QW,r.nf,r.Jm,r.lO,r.ln,r.hU,r.$w,r.iq,E],styles:["span[_ngcontent-%COMP%]{color:red}img[_ngcontent-%COMP%]{max-width:100px;border-radius:100%}"]})}return i})(),ve=(()=>{class i{constructor(t,o,n,a){this.route=t,this.router=o,this.interactionService=n,this.menuController=a,this.authenticationService=(0,e.WQX)(j),this.firestoreService=(0,e.WQX)(S.B),this.userService=(0,e.WQX)(P),this.getQueryParams(),this.getTokenOfProvider(),this.userService.validateHasProfile=!1,this.menuController.enable(!1,"main")}ngOnInit(){}getQueryParams(){var t=this;return(0,d.A)(function*(){const o=t.route.snapshot.queryParams;if(console.log("queryParams -> ",o),o.provider&&o.intentId){const n=o.provider;yield t.interactionService.showLoading("Procesando..."),t.authenticationService.loginWithProvider(n),t.router.navigate(["/user/request-login"],{queryParams:{intentId:o.intentId}})}})()}getTokenOfProvider(){var t=this;return(0,d.A)(function*(){yield t.interactionService.showLoading("Redirigiendo...");const o=yield t.authenticationService.getRedirectResult();if(console.log("getRedirectResult -> ",o),o){const n=k.LD.credentialFromResult(o);console.log("credential -> ",n),t.saveToken(n.idToken?n.idToken:n.accessToken)}else t.interactionService.dismissLoading()})()}saveToken(t){var o=this;return(0,d.A)(function*(){const a=o.route.snapshot.queryParams.intentId;if(a){const s=b.B.Auth.PathIntentsLogin,c={token:t};yield o.firestoreService.updateDocument(`${s}/${a}`,c),o.authenticationService.logout(),console.log("guardado token con \xe9xito")}})()}static#e=this.\u0275fac=function(o){return new(o||i)(e.rXU(_.nX),e.rXU(_.Ix),e.rXU(R.y),e.rXU(r._t))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["app-request-login"]],decls:0,vars:0,template:function(o,n){}})}return i})();var A=f(5597);let be=(()=>{class i{constructor(){this.functions=(0,e.WQX)(A.ah)}call(t,o=null){return(0,A.Qg)(this.functions,t)(o)}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function Ce(i,u){if(1&i&&(e.nrm(0,"img",1),e.nI1(1,"reftourl"),e.nI1(2,"async")),2&i){const t=e.XpG(2);e.Y8G("src",e.bMT(2,3,e.bMT(1,1,t.user.photo)),e.B4B)}}function Fe(i,u){1&i&&e.nrm(0,"img",2)}function ye(i,u){if(1&i&&(e.j41(0,"ion-select-option",4),e.EFF(1),e.k0s()),2&i){const t=u.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function ke(i,u){if(1&i){const t=e.RV6();e.j41(0,"ion-item")(1,"ion-avatar",0),e.DNE(2,Ce,3,5,"img",1)(3,Fe,1,0,"img",2),e.k0s(),e.j41(4,"ion-label")(5,"strong"),e.EFF(6,"Nombre:"),e.k0s(),e.EFF(7),e.j41(8,"p")(9,"strong"),e.EFF(10,"Email:"),e.k0s(),e.EFF(11),e.k0s(),e.j41(12,"p")(13,"strong"),e.EFF(14,"Edad:"),e.k0s(),e.EFF(15),e.k0s()()(),e.j41(16,"ion-item")(17,"ion-select",3),e.bIt("ionChange",function(n){e.eBV(t);const a=e.XpG();return e.Njj(a.changeRol(n))}),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.rolesSelect,n)||(a.rolesSelect=n),e.Njj(n)}),e.Z7z(18,ye,2,2,"ion-select-option",4,e.Vm6),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(2),e.vxM(t.user.photo?2:3),e.R7$(5),e.SpI(" ",t.user.name," "),e.R7$(4),e.SpI(" ",t.user.email,""),e.R7$(4),e.SpI(" ",t.user.age,""),e.R7$(2),e.R50("ngModel",t.rolesSelect),e.R7$(),e.Dyx(t.roles)}}let Se=(()=>{class i{constructor(t){this.interactionService=t,this.functionsService=(0,e.WQX)(be),this.roles=["admin","cliente","motorizado"],this.rolesSelect=[]}ngOnInit(){this.initRoles()}initRoles(){for(const t in this.user.roles)this.rolesSelect.push(t);console.log("this.rolesSelect -> ",this.rolesSelect)}changeRol(t){var o=this;return(0,d.A)(function*(){console.log("changeRol -> ",t.detail.value),yield o.interactionService.showLoading("Actualizando...");const n={};o.rolesSelect.forEach(c=>{n[c]=!0}),console.log("updateDoc roles -> ",{roles:n});const s={roles:n,uid:o.user.id};try{const c=yield o.functionsService.call("appCall",s);o.interactionService.dismissLoading(),o.interactionService.showToast("Rol actualizado con \xe9xito"),console.log("response -> ",c)}catch(c){o.interactionService.dismissLoading(),o.interactionService.presentAlert("Error","No se pudo actualizar el rol del usuario"),console.log("changeRol error -> ",c)}})()}static#e=this.\u0275fac=function(o){return new(o||i)(e.rXU(R.y))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["app-user-detail"]],inputs:{user:"user"},decls:1,vars:1,consts:[["slot","start"],[3,"src"],["src","https://i.pinimg.com/736x/0d/64/98/0d64989794b1a4c9d89bff571d3d5842.jpg"],["label","Rol","label-placement","floating","multiple","",3,"ionChange","ngModelChange","ngModel"],[3,"value"]],template:function(o,n){1&o&&e.DNE(0,ke,20,5),2&o&&e.vxM(n.user?0:-1)},dependencies:[l.BC,l.vS,r.uz,r.mC,r.he,r.Nm,r.Ip,y.Jj,B]})}return i})();function Pe(i,u){if(1&i&&(e.j41(0,"ion-segment-button",12)(1,"ion-label"),e.EFF(2),e.k0s()()),2&i){const t=u.$implicit;e.Y8G("value",t),e.R7$(2),e.JRh(t)}}function je(i,u){if(1&i){const t=e.RV6();e.j41(0,"ion-grid",7)(1,"ion-row",9)(2,"ion-col",10)(3,"ion-segment",11),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.rolSegment,n)||(a.rolSegment=n),e.Njj(n)}),e.bIt("ionChange",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.getMoreUsers(n.rolSegment))}),e.Z7z(4,Pe,3,2,"ion-segment-button",12,e.Vm6),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(3),e.R50("ngModel",t.rolSegment),e.R7$(),e.Dyx(t.roles)}}function Re(i,u){if(1&i&&(e.j41(0,"ion-list",13),e.nrm(1,"app-user-detail",17),e.k0s()),2&i){const t=u.$implicit;e.R7$(),e.Y8G("user",t)}}function we(i,u){1&i&&(e.j41(0,"div",14)(1,"p"),e.EFF(2,"no hay usuarios "),e.k0s()())}function xe(i,u){if(1&i){const t=e.RV6();e.Z7z(0,Re,2,1,"ion-list",13,e.Vm6,!1,we,3,0,"div",14),e.j41(3,"ion-infinite-scroll",15),e.bIt("ionInfinite",function(n){e.eBV(t);const a=e.XpG();return e.Njj(a.loadData(n))}),e.nrm(4,"ion-infinite-scroll-content",16),e.k0s()}if(2&i){const t=e.XpG();e.Dyx(t.users),e.R7$(3),e.Y8G("disabled",!t.enableMore)}}function Ee(i,u){1&i&&(e.nrm(0,"br"),e.j41(1,"div",18),e.nrm(2,"ion-spinner",19),e.k0s())}let Te=(()=>{class i{constructor(t){this.fb=t,this.firestoreService=(0,e.WQX)(S.B),this.roles=["admin","cliente","motorizado"],this.rolSelected="admin",this.cargando=!0,this.enableMore=!1,this.enableBuscarPorEmail=!1,this.formEmail=this.fb.group({email:["",[l.k0.required,l.k0.email]]}),this.rolSegment="admin",this.numItems=4,this.getMoreUsers()}ngOnInit(){}getMoreUsers(t=this.rolSelected){var o=this;return(0,d.A)(function*(){console.log(" getMoreUsers -> ",o.rolSegment),o.rolSelected!=t&&(o.users=null,o.cargando=!0,o.enableMore=!0),o.rolSelected=t,console.log("getMoreUsers");const n=b.B.Auth.PathUsers,a=o.numItems;let s;s=[[`roles.${t}`,"==",!0]];const c={orderParam:"date",directionSort:"desc",limit:a};if(o.users){const g=o.users[o.users.length-1],p=yield o.firestoreService.getDocument(`${n}/${g.id}`);c.startAfter=p}const m=yield o.firestoreService.getDocumentsQuery(n,s,c);o.cargando=!1,console.log("res -> ",m),m.size?(m.size<a&&(o.enableMore=!1),o.users||(o.users=[]),m.forEach(g=>{o.users.push(g.data())})):o.enableMore=!1})()}loadData(t){var o=this;return(0,d.A)(function*(){console.log("loadData"),yield o.getMoreUsers(),t.target.complete()})()}onSearchChange(t){var o=this;return(0,d.A)(function*(){o.enableBuscarPorEmail=!0,console.log("onSearchChange -> ",t);const n=t.detail.value;o.users=null,o.cargando=!0,o.enableMore=!1;const a=b.B.Auth.PathUsers;let s;s=[["email","==",n]];const c=yield o.firestoreService.getDocumentsQuery(a,s);o.cargando=!1,c.empty||c.forEach(m=>{o.users=[],o.users.push(m.data())})})()}cancelSearch(){setTimeout(()=>{this.enableBuscarPorEmail=!1,this.getMoreUsers()},200)}static#e=this.\u0275fac=function(o){return new(o||i)(e.rXU(l.ok))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["app-users"]],decls:15,vars:2,consts:[["translucent","true"],["slot","start"],["defaultHref","/"],["fullscreen","true","color","light"],["collapse","condense"],["size","large"],["placeholder","Correo","type","email","mode","ios","showCancelButton","always","cancelButtonText","cancelar","animated","true",3,"ionChange","ionCancel"],["fixed",""],["threshold","25%","position","bottom",3,"disabled"],[1,"ion-justify-content-center"],["size","11","size-md","8","size-xl","6"],[3,"ngModelChange","ionChange","ngModel"],[3,"value"],["inset",""],[2,"text-align","center"],["threshold","25%","position","bottom",3,"ionInfinite","disabled"],["loadingSpinner","bubbles"],[3,"user"],[1,"ion-text-center"],["name","bubbles"]],template:function(o,n){1&o&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Usuarios"),e.k0s(),e.j41(4,"ion-buttons",1),e.nrm(5,"ion-back-button",2),e.k0s()()(),e.j41(6,"ion-content",3)(7,"ion-header",4)(8,"ion-toolbar")(9,"ion-title",5),e.EFF(10,"Usuarios"),e.k0s()()(),e.j41(11,"ion-searchbar",6),e.bIt("ionChange",function(s){return n.onSearchChange(s)})("ionCancel",function(){return n.cancelSearch()}),e.k0s(),e.DNE(12,je,6,1,"ion-grid",7)(13,xe,5,2,"ion-infinite-scroll",8)(14,Ee,3,0),e.k0s()),2&o&&(e.R7$(12),e.vxM(n.enableBuscarPorEmail?-1:12),e.R7$(),e.vxM(n.cargando?14:13))},dependencies:[l.BC,l.vS,r.W9,r.eU,r.ai,r.BC,r.he,r.el,r.QW,r.nf,r.lO,r.ln,r.hU,r.w2,r.Gp,r.eP,r.Ax,r.Hp,r.S1,Se]})}return i})();var w=function(i){return i.isLogin=(u="/home")=>(console.log("isLogin guard -> ",u),function(){var o=(0,d.A)(function*(n,a){const s=(0,e.WQX)(P),c=(0,e.WQX)(_.Ix),m=yield s.isLogin();return console.log("isLogin -> ",m),!!m||(c.navigate([u]),!1)});return function(a,s){return o.apply(this,arguments)}}()),i.notLogin=(u="/home")=>(console.log("notLogin guard"),function(){var o=(0,d.A)(function*(n,a){const s=(0,e.WQX)(P),c=(0,e.WQX)(_.Ix),m=yield s.isLogin();return console.log("Login -> ",m),!m||(c.navigate([u||"/"]),!1)});return function(a,s){return o.apply(this,arguments)}}()),i.isRol=(u,t="/home")=>(console.log("isRol -> ",u),function(){var n=(0,d.A)(function*(a,s){let c=!1;const m=(0,e.WQX)(P),g=(0,e.WQX)(_.Ix),p=yield m.getState();if(p){const F=yield m.getUserProfile(p.uid);console.log("userProfile -> ",F.roles),u.every(C=>1!=F.roles[C]||(c=!0,!1))}return c||g.navigate([t]),console.log("valid -> ",c),c});return function(s,c){return n.apply(this,arguments)}}()),i.isRolClaim=(u,t="/home")=>(console.log("isRolClaim -> ",u),function(){var n=(0,d.A)(function*(a,s){let c=!1;const m=(0,e.WQX)(P),g=(0,e.WQX)(_.Ix),p=yield m.getState();if(p){const C=(yield p.getIdTokenResult(!0)).claims;C.roles&&u.every(Le=>1!=C.roles[Le]||(c=!0,!1))}return c||g.navigate([t]),console.log("valid -> ",c),c});return function(s,c){return n.apply(this,arguments)}}()),i}(w||{});const Ue=[{path:"login",component:z,canActivate:[w.notLogin("/user/perfil")]},{path:"request-login",component:ve},{path:"registro",component:J,canActivate:[w.notLogin("/user/perfil")]},{path:"completar-registro",component:_e,canActivate:[w.isLogin()]},{path:"perfil",component:fe,canActivate:[w.isLogin()]},{path:"admin",component:Te,canActivate:[w.isRolClaim(["admin"])]}];let Ie=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.$C({type:i});static#o=this.\u0275inj=e.G2t({imports:[_.iI.forChild(Ue),_.iI]})}return i})(),Be=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.$C({type:i});static#o=this.\u0275inj=e.G2t({imports:[y.MD,_.iI]})}return i})(),Ae=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.$C({type:i});static#o=this.\u0275inj=e.G2t({imports:[y.MD,Ie,l.YN,l.X1,Be,r.W9,r.eU,r.ai,r.BC,r.uz,r.mC,r.he,r.b_,r.el,r.QW,r.MC,r.el,r.nf,r.uz,r.Jm,r.Sb,r.lO,r.ln,r.hU,r.$w,r.Wv,r.b_,r.IO,r.ZB,r.iq,r.w2,r.AF,r.nf,r.M0,r.Gp,r.eP,r.Nm,r.Ip,r.Ax,r.Hp,r.S1]})}return i})()}}]);