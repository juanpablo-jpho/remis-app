"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[705],{1705:(xe,P,d)=>{d.r(P),d.d(P,{AuthModule:()=>Ee});var g=d(177),p=d(6217),m=d(467),e=d(3953),b=d(4990),s=d(4341),C=d(9826),r=d(1224);const x=["modalRecuperarPassword"],R=(i,l)=>({"--background":i,"--color":l}),T=()=>["/user/registro"],I=()=>[0,.75];function U(i,l){if(1&i){const o=e.RV6();e.j41(0,"ion-row",9)(1,"ion-col",10)(2,"ion-button",11),e.bIt("click",function(){const n=e.eBV(o).$implicit,a=e.XpG(2);return e.Njj(a.loginWithProvider(n))}),e.EFF(3),e.nrm(4,"ion-icon",12),e.k0s()()()}if(2&i){const o=l.$implicit;e.R7$(2),e.Y8G("ngStyle",e.l_i(3,R,o.color,o.textColor)),e.R7$(),e.SpI(" ",o.name," "),e.R7$(),e.Y8G("name",o.icon)}}function B(i,l){if(1&i&&(e.j41(0,"ion-grid",7),e.Z7z(1,U,5,6,"ion-row",9,e.Vm6),e.k0s()),2&i){const o=e.XpG();e.R7$(),e.Dyx(o.providers)}}function N(i,l){if(1&i){const o=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Reestablecer contrase\xf1a"),e.k0s(),e.j41(4,"ion-buttons",17)(5,"ion-button",29),e.bIt("click",function(){e.eBV(o),e.XpG();const n=e.sdS(30);return e.Njj(n.dismiss())}),e.nrm(6,"ion-icon",30),e.k0s()()()(),e.j41(7,"ion-content",31)(8,"ion-item",32),e.nrm(9,"ion-icon",33),e.j41(10,"ion-label"),e.EFF(11," Te enviaremos un email a tu correo para que puedas reestablecer tu contrase\xf1a "),e.k0s()(),e.j41(12,"form",14),e.bIt("ngSubmit",function(){e.eBV(o);const n=e.XpG(2);return e.Njj(n.resetPassword())}),e.nrm(13,"br")(14,"ion-input",34)(15,"br"),e.j41(16,"div",18)(17,"ion-button",19),e.EFF(18," Enviar correo "),e.k0s()()()()}if(2&i){const o=e.XpG(2);e.R7$(12),e.Y8G("formGroup",o.reestablecerPasswordForm)}}function G(i,l){if(1&i){const o=e.RV6();e.j41(0,"ion-grid",8)(1,"ion-row",9)(2,"ion-col",13)(3,"form",14),e.bIt("ngSubmit",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.loginWithEmail())}),e.nrm(4,"br")(5,"ion-input",15)(6,"br"),e.j41(7,"ion-input",16),e.nrm(8,"ion-input-password-toggle",17),e.k0s(),e.nrm(9,"br"),e.j41(10,"div",18)(11,"ion-button",19),e.EFF(12," Ingresar "),e.k0s()()()()(),e.j41(13,"ion-row",9)(14,"ion-col",20)(15,"ion-list",21)(16,"ion-item",22)(17,"ion-label"),e.EFF(18,"\xbfOlvidaste tu contrase\xf1a?"),e.k0s(),e.j41(19,"ion-buttons",17)(20,"ion-button",23),e.EFF(21," Recuperar "),e.k0s()()(),e.nrm(22,"br"),e.j41(23,"ion-item",24)(24,"ion-label"),e.EFF(25,"\xbfNo tienes un usuario?"),e.k0s(),e.j41(26,"ion-buttons",17)(27,"ion-button",25),e.EFF(28," Reg\xedstrate "),e.k0s()()()()()(),e.j41(29,"ion-modal",26,0),e.DNE(31,N,19,1,"ng-template"),e.k0s(),e.j41(32,"ion-row",9)(33,"ion-col",10)(34,"ion-button",27),e.bIt("click",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.enableLoginWithEmailAndPassword=!1)}),e.EFF(35," Iniciar sesi\xf3n con otro m\xe9todo "),e.nrm(36,"ion-icon",28),e.k0s()()()()}if(2&i){const o=e.XpG();e.R7$(3),e.Y8G("formGroup",o.loginForm),e.R7$(20),e.Y8G("routerLink",e.lJ4(4,T)),e.R7$(6),e.Y8G("initialBreakpoint",.75)("breakpoints",e.lJ4(5,I))}}let M=(()=>{class i{constructor(o,t,n){this.fb=o,this.router=t,this.interactionService=n,this.authenticationService=(0,e.WQX)(b.k),this.cargando=!1,this.enableLoginWithEmailAndPassword=!1,this.datosForm=this.fb.group({email:["",[s.k0.required,s.k0.email]]}),this.loginForm=this.fb.group({email:["",[s.k0.required,s.k0.email]],password:["",[s.k0.required]]}),this.reestablecerPasswordForm=this.fb.group({email:["",[s.k0.required,s.k0.email]]}),this.providers=[{name:"Iniciar sesi\xf3n con Google",id:"google",color:"#20a3df",textColor:"white",icon:"logo-google"},{name:"Iniciar sesi\xf3n con Apple",id:"apple",color:"black",textColor:"white",icon:"logo-apple"},{name:"Iniciar sesi\xf3n con correo y contrase\xf1a",id:"password",color:"#9e9e9e",textColor:"white",icon:"mail"}]}ngOnInit(){}loginWithProvider(o){var t=this;return(0,m.A)(function*(){if("password"==o.id)return void(t.enableLoginWithEmailAndPassword=!0);yield t.interactionService.showLoading("Procesando...");const n=yield t.authenticationService.getTokenOfProvider(o.id),a=yield t.authenticationService.loginWithTokenOfProvider(o.id,n);t.interactionService.dismissLoading(),a&&(t.interactionService.showToast(`Bienvenido ${a.user.displayName}`),setTimeout(()=>{t.router.navigate(["user","perfil"],{replaceUrl:!0})},200))})()}resetPassword(){var o=this;return(0,m.A)(function*(){if(o.reestablecerPasswordForm.valid){const t=o.reestablecerPasswordForm.value;o.modalRecuperarPassword.dismiss(),yield o.interactionService.showLoading("Enviando correo..."),console.log("resetPassword valid -> ",t);try{yield o.authenticationService.sendPasswordResetEmail(t.email),o.interactionService.dismissLoading(),o.interactionService.presentAlert("Importente","Te hemos enviado un correo para reestablecer tu contrase\xf1a"),console.log("te hemos enviado un correo para reestablecer tu contrase\xf1a")}catch(n){console.log("resetPassword error -> ",n)}}})()}loginWithEmail(){var o=this;return(0,m.A)(function*(){if(o.loginForm.valid){const t=o.loginForm.value;yield o.interactionService.showLoading("Ingresando...");try{const n=yield o.authenticationService.login(t.email,t.password);o.interactionService.dismissLoading(),o.interactionService.showToast(`Bienvenido ${n.user.displayName}`),setTimeout(()=>{o.router.navigate(["user","perfil"],{replaceUrl:!0})},500)}catch(n){console.log("login error -> ",n),o.interactionService.dismissLoading(),o.interactionService.presentAlert("Error","Credenciales inv\xe1lidas")}}})()}static#e=this.\u0275fac=function(t){return new(t||i)(e.rXU(s.ok),e.rXU(p.Ix),e.rXU(C.y))};static#o=this.\u0275cmp=e.VBU({type:i,selectors:[["app-login"]],viewQuery:function(t,n){if(1&t&&e.GBs(x,5),2&t){let a;e.mGM(a=e.lsd())&&(n.modalRecuperarPassword=a.first)}},decls:13,vars:2,consts:[["modalRecuperarPassword",""],["translucent","true"],["slot","start"],["defaultHref","/"],["fullscreen","true"],["collapse","condense"],["size","large"],["fixed","",1,"content-center"],["fixed",""],[1,"ion-justify-content-center"],["size","10","size-md","6","size-lg","4"],["expand","block","shape","round",3,"click","ngStyle"],["slot","start",3,"name"],["size","11","size-md","6"],[3,"ngSubmit","formGroup"],["type","email","label","Email","placeholder","Email","fill","outline","mode","md","labelPlacement","floating","errorText","Ingresa un email v\xe1lido","formControlName","email"],["type","password","label","Contrase\xf1a","placeholder","Contrase\xf1a","mode","md","fill","outline","labelPlacement","floating","errorText","Este campo es requerido","formControlName","password"],["slot","end"],[1,"ion-text-center"],["type","submit","shape","round"],["size","12","size-md","6"],["inset",""],["detail","","button","","lines","none","color","light"],["type","button","color","secondary","id","modal-recuperar-password"],["detail","","button","","lines","none","color","light",3,"routerLink"],["color","secondary"],["trigger","modal-recuperar-password",3,"initialBreakpoint","breakpoints"],["expand","block","shape","round","color","medium",3,"click"],["slot","start","name","arrow-back"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-padding"],["lines","none"],["name","information-circle","slot","start","color","primary"],["type","email","label","Ingresa tu email","placeholder","Email","fill","outline","mode","md","formControlName","email","labelPlacement","floating","errorText","Ingresa un email v\xe1lido"]],template:function(t,n){1&t&&(e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Login"),e.k0s(),e.j41(4,"ion-buttons",2),e.nrm(5,"ion-back-button",3),e.k0s()()(),e.j41(6,"ion-content",4)(7,"ion-header",5)(8,"ion-toolbar")(9,"ion-title",6),e.EFF(10,"Login"),e.k0s()()(),e.DNE(11,B,3,0,"ion-grid",7)(12,G,37,6,"ion-grid",8),e.k0s()),2&t&&(e.R7$(11),e.vxM(n.enableLoginWithEmailAndPassword?-1:11),e.R7$(),e.vxM(n.enableLoginWithEmailAndPassword?12:-1))},dependencies:[g.B3,p.Wk,s.qT,s.BC,s.cb,s.j4,s.JD,r.W9,r.eU,r.ai,r.BC,r.uz,r.he,r.el,r.QW,r.nf,r.Jm,r.Sb,r.lO,r.ln,r.hU,r.$w,r.Wv,r.iq,r.gf],styles:["span[_ngcontent-%COMP%]{color:red;width:100%;display:flex;margin-bottom:15px}"]})}return i})();var f=d(7553),F=d(9146),j=d(2662),S=d(9885),y=d(8040);const D=()=>["/user/login"];function X(i,l){1&i&&(e.j41(0,"span",25)(1,"i"),e.EFF(2,"Este campo es "),e.j41(3,"strong"),e.EFF(4,"requerido"),e.k0s()()())}function $(i,l){if(1&i&&(e.j41(0,"div",22),e.nrm(1,"img",26),e.nI1(2,"filetourl"),e.k0s()),2&i){const o=e.XpG();e.R7$(),e.Y8G("src",e.bMT(2,1,o.datosForm.controls.photo.value),e.B4B)}}let A=(()=>{class i{constructor(o,t,n){this.fb=o,this.router=t,this.interactionService=n,this.authenticationService=(0,e.WQX)(b.k),this.firestoreService=(0,e.WQX)(F.B),this.storageService=(0,e.WQX)(j.n),this.userService=(0,e.WQX)(S.D),this.datosForm=this.fb.group({email:["",[s.k0.required,s.k0.email]],password:["",s.k0.required],name:["",s.k0.required],photo:[null,s.k0.required],age:[null,s.k0.required]}),this.cargando=!1}ngOnInit(){return(0,m.A)(function*(){})()}registrarse(){var o=this;return(0,m.A)(function*(){if(o.cargando=!0,console.log("datosForm -> ",o.datosForm),o.datosForm.valid){const t=o.datosForm.value;console.log("valid -> ",t);try{yield o.interactionService.showLoading("Registrando...");const n=t.photo;o.userService.validateHasProfile=!1;const a=yield o.authenticationService.createUser(t.email,t.password),u=`PhotosPerfil/${a.user.uid}`,c=yield o.storageService.uploadFile(u,n.name,n),_=yield o.storageService.getDownloadURL(c.ref.fullPath);console.log("url -> ",_);let h={displayName:t.name,photoURL:c.ref.fullPath};yield o.authenticationService.updateProfile(h);const v={name:t.name,photo:c.ref.fullPath,age:t.age,id:a.user.uid,email:t.email,roles:{cliente:!0}};console.log("datosUser -> ",v),yield o.firestoreService.createDocument(f.B.Auth.PathUsers,v,a.user.uid),o.interactionService.dismissLoading(),o.interactionService.showToast("Usuario creado con \xe9xito"),console.log("usuario creado con \xe9xito"),o.router.navigate(["/user/perfil"])}catch(n){console.log("registrarse error -> ",n),o.interactionService.presentAlert("Error","Ocurri\xf3 un error, intenta nuevamente")}}o.cargando=!1})()}viewPreview(o){var t=this;return(0,m.A)(function*(){if(o.files.length){const n=o.files;console.log("viewPreview files -> ",n);const a=n.item(0);t.datosForm.controls.photo.setValue(a),console.log("this.datosForm.controls.photo -> ",t.datosForm.controls.photo.value)}})()}download(o){this.storageService.downloadFile(o)}static#e=this.\u0275fac=function(t){return new(t||i)(e.rXU(s.ok),e.rXU(p.Ix),e.rXU(C.y))};static#o=this.\u0275cmp=e.VBU({type:i,selectors:[["app-registro"]],decls:46,vars:5,consts:[["inputFile",""],["translucent","true"],["slot","start"],["defaultHref","/"],["fullscreen","true","color","light"],["collapse","condense"],["size","large"],["fixed",""],[1,"ion-justify-content-center"],["size","11","size-md","8","size-xl","6"],[3,"ngSubmit","formGroup"],["type","email","placeholder","Email","label","Email","labelPlacement","floating","mode","md","fill","outline","formControlName","email","errorText","Ingresa un email v\xe1lido"],["type","password","placeholder","Contrase\xf1a","label","Contrase\xf1a","labelPlacement","floating","mode","md","fill","outline","formControlName","password","errorText","Debe tener m\xednimo 6 caracteres"],["slot","end"],["type","text","placeholder","Juan","label","Tu nombre de usuario","labelPlacement","floating","mode","md","fill","outline","formControlName","name","errorText","Este campo es requerido"],["type","number","placeholder","20","label","Edad","labelPlacement","floating","mode","md","fill","outline","formControlName","age","errorText","Este campo es requerido"],["type","file","accept","image/*",2,"display","none",3,"change"],["inset","","mode","ios"],["lines","none"],[3,"click"],["slot","icon-only","name","image"],["style","text-align: end;",4,"ngIf"],[1,"ion-text-center"],["type","submit","shape","round"],["color","medium","shape","round",3,"routerLink"],[2,"text-align","end"],[2,"max-width","150px",3,"src"]],template:function(t,n){if(1&t){const a=e.RV6();e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Registrarse"),e.k0s(),e.j41(4,"ion-buttons",2),e.nrm(5,"ion-back-button",3),e.k0s()()(),e.j41(6,"ion-content",4)(7,"ion-header",5)(8,"ion-toolbar")(9,"ion-title",6),e.EFF(10,"Registrarse"),e.k0s()()(),e.j41(11,"ion-grid",7)(12,"ion-row",8)(13,"ion-col",9)(14,"form",10),e.bIt("ngSubmit",function(){return e.eBV(a),e.Njj(n.registrarse())}),e.nrm(15,"br")(16,"ion-input",11)(17,"br"),e.j41(18,"ion-input",12),e.nrm(19,"ion-input-password-toggle",13),e.k0s(),e.nrm(20,"br")(21,"ion-input",14)(22,"br")(23,"ion-input",15)(24,"br"),e.j41(25,"input",16,0),e.bIt("change",function(){e.eBV(a);const c=e.sdS(26);return e.Njj(n.viewPreview(c))}),e.k0s(),e.j41(27,"ion-list",17)(28,"ion-item",18)(29,"ion-label"),e.EFF(30,"Selecciona una foto de perfil"),e.k0s(),e.j41(31,"ion-buttons",13)(32,"ion-button",19),e.bIt("click",function(){e.eBV(a);const c=e.sdS(26);return e.Njj(c.click())}),e.nrm(33,"ion-icon",20),e.k0s()()()(),e.DNE(34,X,5,0,"span",21),e.nrm(35,"br"),e.DNE(36,$,3,3,"div",22),e.nrm(37,"br"),e.j41(38,"div",22)(39,"ion-button",23),e.EFF(40," Registrarse "),e.k0s()()()()()(),e.j41(41,"div",22)(42,"p"),e.EFF(43," \xbfYa tienes un usuario?"),e.k0s(),e.j41(44,"ion-button",24),e.EFF(45," Ingresar "),e.k0s()()()}2&t&&(e.R7$(14),e.Y8G("formGroup",n.datosForm),e.R7$(20),e.Y8G("ngIf",n.datosForm.controls.photo.hasError("required")),e.R7$(2),e.vxM(null!=n.datosForm&&null!=n.datosForm.controls&&null!=n.datosForm.controls.photo&&n.datosForm.controls.photo.value?36:-1),e.R7$(8),e.Y8G("routerLink",e.lJ4(4,D)))},dependencies:[g.bT,p.Wk,s.qT,s.BC,s.cb,s.j4,s.JD,r.W9,r.eU,r.ai,r.BC,r.uz,r.he,r.el,r.QW,r.nf,r.Jm,r.lO,r.ln,r.hU,r.$w,r.Wv,r.iq,r.gf,y.R],styles:["span[_ngcontent-%COMP%]{color:red}img[_ngcontent-%COMP%]{max-width:100px;border-radius:100%}"]})}return i})();var E=d(2097);const L=["modalEditInfo"],V=()=>["/"],z=()=>[0,.75];function W(i,l){1&i&&(e.j41(0,"div",12)(1,"ion-chip",29),e.nrm(2,"ion-icon",30),e.j41(3,"ion-label"),e.EFF(4,"correo verificado"),e.k0s()()())}function O(i,l){if(1&i){const o=e.RV6();e.j41(0,"div",12)(1,"ion-chip",31),e.nrm(2,"ion-icon",32),e.j41(3,"ion-label"),e.EFF(4,"correo no verificado"),e.k0s()()(),e.j41(5,"ion-list",16)(6,"ion-item",33),e.bIt("click",function(){e.eBV(o);const n=e.XpG(3);return e.Njj(n.enviarCorreo())}),e.nrm(7,"ion-icon",34),e.j41(8,"ion-label"),e.EFF(9,"Enviar correo de verificaci\xf3n"),e.k0s()()()}}function q(i,l){if(1&i){const o=e.RV6();e.j41(0,"ion-item",10),e.nrm(1,"ion-icon",37),e.j41(2,"ion-label"),e.EFF(3," Ingresa el nuevo correo, te enviaremos un enlace de verificaci\xf3n para que el cambio sea exitoso. "),e.k0s()(),e.j41(4,"form",38),e.bIt("ngSubmit",function(){e.eBV(o);const n=e.XpG(4);return e.Njj(n.actualizarEmail())}),e.nrm(5,"br")(6,"ion-input",39)(7,"br"),e.j41(8,"div",40)(9,"ion-button",41),e.EFF(10," actualizar "),e.k0s()()()}if(2&i){const o=e.XpG(4);e.R7$(4),e.Y8G("formGroup",o.formNewEmail)}}function Q(i,l){if(1&i){const o=e.RV6();e.j41(0,"ion-item",10),e.nrm(1,"ion-icon",37),e.j41(2,"ion-label"),e.EFF(3," Ingresa tu nombre de perfil "),e.k0s()(),e.nrm(4,"br"),e.j41(5,"ion-input",42),e.mxI("ngModelChange",function(n){e.eBV(o);const a=e.XpG(4);return e.DH7(a.newName,n)||(a.newName=n),e.Njj(n)}),e.k0s(),e.nrm(6,"br"),e.j41(7,"div",40)(8,"ion-button",43),e.bIt("click",function(){e.eBV(o);const n=e.XpG(4);return e.Njj(n.actualizarPerfil())}),e.EFF(9," actualizar "),e.k0s()()}if(2&i){const o=e.XpG(4);e.R7$(5),e.R50("ngModel",o.newName)}}function Y(i,l){if(1&i&&(e.nrm(0,"img",11),e.nI1(1,"reftourl"),e.nI1(2,"async")),2&i){const o=e.XpG(5);e.Y8G("src",e.bMT(2,3,e.bMT(1,1,o.user.photoURL)),e.B4B)}}function J(i,l){if(1&i&&(e.nrm(0,"img",11),e.nI1(1,"filetourl")),2&i){const o=e.XpG(5);e.Y8G("src",e.bMT(1,1,o.newImage),e.B4B)}}function H(i,l){if(1&i){const o=e.RV6();e.j41(0,"div",40)(1,"ion-button",43),e.bIt("click",function(){e.eBV(o);const n=e.XpG(5);return e.Njj(n.editarProfilePicture())}),e.EFF(2," actualizar "),e.k0s()()}}function Z(i,l){if(1&i){const o=e.RV6();e.j41(0,"input",44,1),e.bIt("change",function(){e.eBV(o);const n=e.sdS(1),a=e.XpG(4);return e.Njj(a.viewPreview(n))}),e.k0s(),e.j41(2,"ion-item")(3,"ion-avatar",3),e.DNE(4,Y,3,5,"img",11)(5,J,2,3,"img",11),e.k0s(),e.j41(6,"ion-buttons",25)(7,"ion-button",26),e.bIt("click",function(){e.eBV(o);const n=e.sdS(1);return e.Njj(n.click())}),e.nrm(8,"ion-icon",19),e.EFF(9," editar "),e.k0s(),e.j41(10,"ion-button",26),e.bIt("click",function(){e.eBV(o);const n=e.XpG(4);return e.Njj(n.downloadProfilePicture())}),e.nrm(11,"ion-icon",45),e.k0s()()(),e.nrm(12,"br"),e.DNE(13,H,3,0,"div",40)}if(2&i){const o=e.XpG(4);e.R7$(4),e.vxM(o.newImage?5:4),e.R7$(9),e.vxM(o.newImage?13:-1)}}function K(i,l){1&i&&(e.j41(0,"span")(1,"i"),e.EFF(2,"Las contrase\xf1as no "),e.j41(3,"strong"),e.EFF(4,"coinciden"),e.k0s()()())}function ee(i,l){if(1&i){const o=e.RV6();e.j41(0,"ion-item",10),e.nrm(1,"ion-icon",37),e.j41(2,"ion-label"),e.EFF(3," Ingresa una nueva contrase\xf1a, para completar esta acci\xf3n debes haber iniciado sesi\xf3n recientemente "),e.k0s()(),e.nrm(4,"br"),e.j41(5,"form",38),e.bIt("ngSubmit",function(){e.eBV(o);const n=e.XpG(4);return e.Njj(n.cambiarPassword())}),e.j41(6,"ion-input",46),e.nrm(7,"ion-input-password-toggle",25),e.k0s(),e.nrm(8,"br"),e.j41(9,"ion-input",47),e.nrm(10,"ion-input-password-toggle",25),e.k0s(),e.DNE(11,K,5,0,"span",48),e.nrm(12,"br"),e.j41(13,"div",40)(14,"ion-button",41),e.EFF(15," establecer "),e.k0s()()()}if(2&i){const o=e.XpG(4);e.R7$(5),e.Y8G("formGroup",o.formCambiarPassword),e.R7$(),e.Y8G("counter",!0),e.R7$(5),e.Y8G("ngIf",o.formCambiarPassword.controls.repetPassword.hasError("notSame"))}}function oe(i,l){if(1&i){const o=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",25)(5,"ion-button",26),e.bIt("click",function(){e.eBV(o),e.XpG();const n=e.sdS(54);return e.Njj(n.isOpen=!1)}),e.nrm(6,"ion-icon",35),e.k0s()()()(),e.j41(7,"ion-content",36),e.DNE(8,q,11,1)(9,Q,10,1)(10,Z,14,2)(11,ee,16,3),e.k0s()}if(2&i){const o=e.XpG(3);e.R7$(3),e.JRh(o.titleModal),e.R7$(5),e.vxM("email"==o.opcModal?8:-1),e.R7$(),e.vxM("name"==o.opcModal?9:-1),e.R7$(),e.vxM("photo"==o.opcModal?10:-1),e.R7$(),e.vxM("password"==o.opcModal?11:-1)}}function te(i,l){if(1&i){const o=e.RV6();e.j41(0,"ion-list")(1,"ion-list-header",9)(2,"ion-label")(3,"i"),e.EFF(4,"Bienvenido"),e.k0s()()(),e.j41(5,"ion-item",10)(6,"ion-avatar",3),e.nrm(7,"img",11),e.nI1(8,"reftourl"),e.nI1(9,"async"),e.k0s(),e.j41(10,"ion-label"),e.EFF(11),e.j41(12,"p"),e.EFF(13),e.k0s()()()(),e.DNE(14,W,5,0,"div",12)(15,O,10,0),e.j41(16,"ion-grid",13)(17,"ion-row",14)(18,"ion-col",15)(19,"ion-list",16)(20,"ion-item",17),e.bIt("click",function(){e.eBV(o);const n=e.XpG(2);return e.Njj(n.selectOpcModal("email"))}),e.nrm(21,"ion-icon",18),e.j41(22,"ion-label"),e.EFF(23,"Editar correo"),e.k0s()(),e.j41(24,"ion-item",17),e.bIt("click",function(){e.eBV(o);const n=e.XpG(2);return e.Njj(n.selectOpcModal("photo"))}),e.nrm(25,"ion-icon",19),e.j41(26,"ion-label"),e.EFF(27,"Editar foto de perfil"),e.k0s()(),e.j41(28,"ion-item",17),e.bIt("click",function(){e.eBV(o);const n=e.XpG(2);return e.Njj(n.selectOpcModal("name"))}),e.nrm(29,"ion-icon",20),e.j41(30,"ion-label"),e.EFF(31,"Editar nombre de perfil"),e.k0s()(),e.j41(32,"ion-item",17),e.bIt("click",function(){e.eBV(o);const n=e.XpG(2);return e.Njj(n.selectOpcModal("password"))}),e.nrm(33,"ion-icon",21),e.j41(34,"ion-label"),e.EFF(35,"Establecer contrase\xf1a"),e.k0s()(),e.j41(36,"ion-item",17),e.bIt("click",function(){e.eBV(o);const n=e.XpG(2);return e.Njj(n.salir())}),e.nrm(37,"ion-icon",22),e.j41(38,"ion-label"),e.EFF(39,"Cerrar sesi\xf3n"),e.k0s()(),e.j41(40,"ion-item",17),e.bIt("click",function(){e.eBV(o);const n=e.XpG(2);return e.Njj(n.eliminarCuenta())}),e.nrm(41,"ion-icon",23),e.j41(42,"ion-label"),e.EFF(43,"Eliminar cuenta"),e.k0s()()()()()(),e.j41(44,"ion-list",16)(45,"ion-list-header",9)(46,"ion-label"),e.EFF(47,"Informaci\xf3n"),e.k0s()(),e.j41(48,"ion-item",10)(49,"ion-input",24),e.mxI("ngModelChange",function(n){e.eBV(o);const a=e.XpG(2);return e.DH7(a.userProfile.age,n)||(a.userProfile.age=n),e.Njj(n)}),e.k0s(),e.j41(50,"ion-buttons",25)(51,"ion-button",26),e.bIt("click",function(){e.eBV(o);const n=e.XpG(2);return e.Njj(n.actualizarEdad())}),e.nrm(52,"ion-icon",27),e.k0s()()()(),e.j41(53,"ion-modal",28,0),e.DNE(55,oe,12,5,"ng-template"),e.k0s(),e.nrm(56,"br")(57,"br")}if(2&i){const o=e.XpG(2);e.R7$(7),e.Y8G("src",e.bMT(9,9,e.bMT(8,7,o.user.photoURL)),e.B4B),e.R7$(4),e.SpI(" ",o.user.displayName," "),e.R7$(2),e.JRh(o.user.email),e.R7$(),e.vxM(o.user.emailVerified?14:15),e.R7$(35),e.R50("ngModel",o.userProfile.age),e.R7$(4),e.Y8G("initialBreakpoint",.75)("breakpoints",e.lJ4(11,z))}}function ne(i,l){if(1&i&&e.DNE(0,te,58,12),2&i){const o=e.XpG();e.vxM(o.user&&o.userProfile?0:-1)}}function ie(i,l){1&i&&(e.nrm(0,"br"),e.j41(1,"div",40),e.nrm(2,"ion-spinner",49),e.k0s())}let re=(()=>{class i{constructor(o,t,n){this.fb=o,this.router=t,this.interactionService=n,this.authenticationService=(0,e.WQX)(b.k),this.firestoreService=(0,e.WQX)(F.B),this.userService=(0,e.WQX)(S.D),this.storageService=(0,e.WQX)(j.n),this.newName="",this.newPhoto="",this.iniciando=!0,this.formNewEmail=this.fb.group({email:["",[s.k0.required,s.k0.email]]}),this.isSame=a=>(console.log("input -> ",a.value),this.formCambiarPassword?.value?.newPassword!=a?.value?{notSame:!0}:{}),this.formCambiarPassword=this.fb.group({newPassword:["",[s.k0.required,s.k0.minLength(6)]],repetPassword:["",[s.k0.required,this.isSame]]}),this.iniciando=!0,this.user=this.authenticationService.getCurrentUser(),this.getDatosProfile(this.user.uid)}ngOnInit(){}ionViewDidEnter(){const o=this.authenticationService.getCurrentUser();console.log("ionViewDidEnter login -> ",o),o&&(this.user=o)}salir(){this.authenticationService.logout()}actualizarPerfil(){var o=this;return(0,m.A)(function*(){let t={};if(o.newName&&(t.displayName=o.newName),t.displayName){o.modalEditInfo.isOpen=!1,yield o.interactionService.showLoading("Actualizando..."),yield o.authenticationService.updateProfile(t);const n=o.authenticationService.getCurrentUser(),a={name:n.displayName,photo:n.photoURL};yield o.firestoreService.updateDocument(`${f.B.Auth.PathUsers}/${n.uid}`,a),o.interactionService.dismissLoading(),o.interactionService.showToast("Actualizado con \xe9xito"),o.user=n,o.newName=null,o.newPhoto=null}})()}getDatosProfile(o){var t=this;return(0,m.A)(function*(){console.log("getDatosProfile -> ",o),t.firestoreService.getDocumentChanges(`${f.B.Auth.PathUsers}/${o}`).subscribe(n=>{n&&(t.userProfile=n,console.log("this.userProfile -> ",t.userProfile)),t.iniciando=!1})})()}actualizarEdad(){var o=this;return(0,m.A)(function*(){const t=o.authenticationService.getCurrentUser(),n={age:o.userProfile.age};yield o.interactionService.showLoading("Actualizando..."),yield o.firestoreService.updateDocument(`${f.B.Auth.PathUsers}/${t.uid}`,n),console.log("actualizado con \xe9xito"),yield o.interactionService.dismissLoading(),o.interactionService.showToast("Actualizado con \xe9xito")})()}actualizarEmail(){var o=this;return(0,m.A)(function*(){if(o.formNewEmail.valid){const t=o.formNewEmail.value;console.log("valid -> ",t);try{yield o.interactionService.showLoading("Enviando enlace de verificaci\xf3n..."),yield o.authenticationService.verifyBeforeUpdateEmail(t.email),o.interactionService.dismissLoading(),yield o.interactionService.presentAlert("Importante",`Te hemos enviado un correo a <strong>${t.email}</strong> para que puedas verificar tu nuevo correo, \n              verif\xedcalo e inicia sesi\xf3n con el nuevo correo, caso contrario inicia sesi\xf3n con tu correo de siempre`),yield o.authenticationService.logout(!1),o.modalEditInfo.isOpen=!1,setTimeout(()=>{o.router.navigate(["/user/login"])},200)}catch(n){console.log("error al actualizar el correo -> ",n),o.interactionService.dismissLoading(),o.modalEditInfo.isOpen=!1,(yield o.interactionService.presentAlert("Error","Para realizar esta acci\xf3n debes haber realizado un inicio de sesi\xf3n reciente.\n        \xbfDeseas cerrar sesi\xf3n y volver a ingresar para realizar esta acci\xf3n?","Cancelar"))&&(yield o.authenticationService.logout(!1),setTimeout(()=>{o.router.navigate(["/user/login"],{replaceUrl:!0})},200))}}})()}enviarCorreo(){var o=this;return(0,m.A)(function*(){o.interactionService.showLoading("Enviando correo..."),yield o.authenticationService.sendEmailVerification(),o.interactionService.dismissLoading(),yield o.interactionService.presentAlert("Importante","Te hemos enviado un enlace de verificaci\xf3n a tu correo"),console.log("correo enviado -> comprueba tu correo")})()}cambiarPassword(){var o=this;return(0,m.A)(function*(){if(console.log("this.formCambiarPassword -> ",o.formCambiarPassword),o.formCambiarPassword.valid){const t=o.formCambiarPassword.value;console.log("valid -> ",t);try{yield o.interactionService.showLoading("Validando..."),yield o.authenticationService.updatePassword(t.newPassword),o.interactionService.dismissLoading(),o.interactionService.showToast("Contrase\xf1a establecida con \xe9xito"),o.modalEditInfo.isOpen=!1,console.log("contrase\xf1a actualizada con \xe9xito")}catch(n){console.log("error al cambiar la contrase\xf1a -> ",n),o.interactionService.dismissLoading(),(yield o.interactionService.presentAlert("Error","Para establacer una nueva contrase\xf1a debes cerrar tu sesi\xf3n e ingresar nuevamente, <strong>\xbfDeseas cerrar tu sesi\xf3n?</strong>","Cancelar"))&&(yield o.authenticationService.logout(!1),setTimeout(()=>{o.router.navigate(["/user/login"])},200))}}})()}eliminarCuenta(){var o=this;return(0,m.A)(function*(){if(yield o.interactionService.presentAlert("Importante","Seguro que deseas eliminar tu cuenta, <strong>esta acci\xf3n no se puede revertir</strong>","Cancelar"))try{yield o.interactionService.showLoading("Eliminando...");const n=o.authenticationService.getCurrentUser();yield o.authenticationService.updatePassword("xxxxxx"),yield o.firestoreService.deleteDocument(`${f.B.Auth.PathUsers}/${n.uid}`),yield o.authenticationService.deleteUser(),console.log("cuenta eliminada con \xe9xito"),yield o.interactionService.dismissLoading(),yield o.authenticationService.logout(),o.router.navigate(["/user/login"])}catch(n){console.log("error al eliminar la cuenta -> ",n),(yield o.interactionService.presentAlert("Error","Para eliminar tu cuenta debes cerrar tu sesi\xf3n e ingresar nuevamente, <strong>\xbfDeseas cerrar tu sesi\xf3n?</strong>","Cancelar"))&&(yield o.authenticationService.logout(!1),setTimeout(()=>{o.router.navigate(["/user/login"],{replaceUrl:!0})},200))}})()}downloadProfilePicture(){var o=this;return(0,m.A)(function*(){yield o.storageService.downloadFile(o.userProfile.photo),console.log("imagen descargada con \xe9xito")})()}editarProfilePicture(){var o=this;return(0,m.A)(function*(){console.log("subiendo..."),yield o.interactionService.showLoading("Subiendo...");const t=`PhotosPerfil/${o.user.uid}`,n=o.newImage.name,a=yield o.storageService.uploadFile(t,n,o.newImage);yield o.authenticationService.updateProfile({photoURL:a.ref.fullPath});const u={photo:a.ref.fullPath};yield o.firestoreService.updateDocument(`${f.B.Auth.PathUsers}/${o.user.uid}`,u),o.user=o.authenticationService.getCurrentUser(),o.interactionService.dismissLoading(),o.interactionService.showToast("Actualizado con \xe9xito"),o.newImage=null,o.modalEditInfo.isOpen=!1})()}viewPreview(o){var t=this;return(0,m.A)(function*(){o.files.length&&(t.newImage=o.files.item(0))})()}selectOpcModal(o){this.opcModal=o,"email"==this.opcModal&&(this.titleModal="Cambiar correo"),"photo"==this.opcModal&&(this.titleModal="Cambiar foto"),"name"==this.opcModal&&(this.titleModal="Cambiar nombre",this.newName=this.user.displayName),"password"==this.opcModal&&(this.titleModal="Cambiar contrase\xf1a"),this.modalEditInfo.isOpen=!0}static#e=this.\u0275fac=function(t){return new(t||i)(e.rXU(s.ok),e.rXU(p.Ix),e.rXU(C.y))};static#o=this.\u0275cmp=e.VBU({type:i,selectors:[["app-perfil"]],viewQuery:function(t,n){if(1&t&&e.GBs(L,5),2&t){let a;e.mGM(a=e.lsd())&&(n.modalEditInfo=a.first)}},decls:14,vars:3,consts:[["modalEditInfo",""],["files",""],["translucent","true"],["slot","start"],[3,"routerLink"],["slot","icon-only","name","arrow-back"],["fullscreen","true","color","light"],["collapse","condense"],["size","large"],["mode","ios"],["lines","none"],[3,"src"],[1,"ion-text-end"],["fixed","",1,"ion-no-padding"],[1,"ion-justify-content-center"],["size","12","size-md","8"],["inset",""],["button","",3,"click"],["slot","start","name","mail"],["slot","start","name","image"],["slot","start","name","person"],["slot","start","name","finger-print"],["slot","start","name","log-out"],["slot","start","name","trash","color","danger"],["label","Edad","mode","md","labelPlacement","floating",3,"ngModelChange","ngModel"],["slot","end"],[3,"click"],["slot","icon-only","name","save"],[3,"initialBreakpoint","breakpoints"],["color","success","mode","ios"],["name","checkmark-circle"],["color","danger","mode","ios"],["name","close-circle"],["button","","detail","false","lines","none",3,"click"],["name","send","slot","end"],["slot","icon-only","name","close"],[1,"ion-padding"],["name","information-circle","slot","start","color","primary"],[3,"ngSubmit","formGroup"],["type","email","placeholder","email","label","Nuevo correo","labelPlacement","floating","fill","outline","mode","md","formControlName","email","errorText","Ingresa un correo v\xe1lido"],[1,"ion-text-center"],["type","submit","shape","round"],["label","Nombre","type","text","placeholder","Nombre","fill","outline","mode","md","labelPlacement","floating",3,"ngModelChange","ngModel"],["shape","round",3,"click"],["type","file","accept","image/*",2,"display","none",3,"change"],["slot","icon-only","name","cloud-download"],["type","password","label","Contrase\xf1a","placeholder","Contrase\xf1a","mode","md","fill","outline","labelPlacement","floating","errorText","Debe ser m\xednimo de 6 caracteres","formControlName","newPassword","minlength","6",3,"counter"],["type","password","label","Repita la contrase\xf1a","placeholder","Contrase\xf1a","mode","md","fill","outline","labelPlacement","floating","formControlName","repetPassword"],[4,"ngIf"],["name","bubbles"]],template:function(t,n){1&t&&(e.j41(0,"ion-header",2)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Perfil"),e.k0s(),e.j41(4,"ion-buttons",3)(5,"ion-button",4),e.nrm(6,"ion-icon",5),e.k0s()()()(),e.j41(7,"ion-content",6)(8,"ion-header",7)(9,"ion-toolbar")(10,"ion-title",8),e.EFF(11,"Perfil"),e.k0s()()(),e.DNE(12,ne,1,1)(13,ie,3,0),e.k0s()),2&t&&(e.R7$(5),e.Y8G("routerLink",e.lJ4(2,V)),e.R7$(7),e.vxM(n.iniciando?13:12))},dependencies:[g.bT,p.Wk,s.qT,s.BC,s.cb,s.xh,s.vS,s.j4,s.JD,r.W9,r.eU,r.ai,r.BC,r.uz,r.mC,r.he,r.QW,r.nf,r.Jm,r.Sb,r.lO,r.ln,r.hU,r.$w,r.Wv,r.ZB,r.iq,r.w2,r.AF,r.gf,g.Jj,y.R,E.g]})}return i})();function ae(i,l){1&i&&(e.j41(0,"span")(1,"i"),e.EFF(2,"Este campo es "),e.j41(3,"strong"),e.EFF(4,"requerido"),e.k0s()()())}function se(i,l){if(1&i&&(e.j41(0,"div",20),e.nrm(1,"img",25),e.nI1(2,"filetourl"),e.k0s()),2&i){const o=e.XpG();e.R7$(),e.Y8G("src",e.bMT(2,1,o.datosFormCompleteRegistro.controls.photo.value),e.B4B)}}let le=(()=>{class i{constructor(o,t,n){this.fb=o,this.router=t,this.interactionService=n,this.authenticationService=(0,e.WQX)(b.k),this.firestoreService=(0,e.WQX)(F.B),this.storageService=(0,e.WQX)(j.n),this.cargando=!1,this.datosFormCompleteRegistro=this.fb.group({email:["",[s.k0.required,s.k0.email]],name:["",s.k0.required],photo:[null,s.k0.required],age:[null,s.k0.required]}),this.user=this.authenticationService.auth.currentUser,this.datosFormCompleteRegistro.setValue({email:this.user.email,name:this.user.displayName,photo:this.user.photoURL,age:null})}ngOnInit(){}completarRegistro(){var o=this;return(0,m.A)(function*(){if(o.cargando=!0,console.log("datosFormCompleteRegistro -> ",o.datosFormCompleteRegistro),o.datosFormCompleteRegistro.valid){yield o.interactionService.showLoading("Procensando...");const t=o.datosFormCompleteRegistro.value;console.log("valid -> ",t);try{let n=t.photo;if("string"!=typeof t.photo){const _=t.photo,h=`PhotosPerfil/${o.user.uid}`,v=yield o.storageService.uploadFile(h,_.name,_),we=yield o.storageService.getDownloadURL(v.ref.fullPath);console.log("url -> ",we),n=v.ref.fullPath}let a={displayName:t.name,photoURL:n};const u=o.authenticationService.getCurrentUser();yield o.authenticationService.updateProfile(a);const c={name:t.name,photo:n,age:t.age,id:u.uid,email:t.email,roles:{cliente:!0}};console.log("datosUser -> ",c),yield o.firestoreService.createDocument(f.B.Auth.PathUsers,c,u.uid),console.log("completado registro con \xe9xito"),o.interactionService.dismissLoading(),o.interactionService.showToast("Completado registro con \xe9xito"),o.router.navigate(["/user/perfil"])}catch(n){console.log("registrarse error -> ",n),o.interactionService.presentAlert("Error","Ocurri\xf3 un error, intenta nuevamente")}}o.cargando=!1})()}viewPreview(o){var t=this;return(0,m.A)(function*(){if(o.files.length){const n=o.files;console.log("viewPreview files -> ",n);const a=n.item(0);t.datosFormCompleteRegistro.controls.photo.setValue(a),console.log("this.datosFormCompleteRegistro.controls.photo -> ",t.datosFormCompleteRegistro.controls.photo.value)}})()}salir(){this.authenticationService.logout()}static#e=this.\u0275fac=function(t){return new(t||i)(e.rXU(s.ok),e.rXU(p.Ix),e.rXU(C.y))};static#o=this.\u0275cmp=e.VBU({type:i,selectors:[["app-completar-registro"]],decls:42,vars:3,consts:[["inputFile",""],["translucent","true"],["fullscreen","true","color","light"],["collapse","condense"],["size","large"],["fixed",""],[1,"ion-justify-content-center"],["size","11","size-md","8","size-xl","6"],[3,"ngSubmit","formGroup"],["type","text","label","Email","formControlName","email","readonly","","fill","outline","mode","md","labelPlacement","floating"],["type","text","placeholder","Juan","label","Tu nombre de usuario","labelPlacement","floating","mode","md","fill","outline","formControlName","name","errorText","Este campo es requerido"],["type","number","placeholder","20","label","Edad","labelPlacement","floating","mode","md","fill","outline","formControlName","age","errorText","Este campo es requerido"],["type","file","accept","image/*",2,"display","none",3,"change"],["inset","","mode","ios"],["lines","none"],["slot","end"],[3,"click"],["slot","icon-only","name","image"],[2,"text-align","end"],[4,"ngIf"],[1,"ion-text-center"],["type","submit","shape","round"],["mode","ios"],["button","",3,"click"],["slot","start","name","log-out"],[3,"src"]],template:function(t,n){if(1&t){const a=e.RV6();e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Completar registro"),e.k0s()()(),e.j41(4,"ion-content",2)(5,"ion-header",3)(6,"ion-toolbar")(7,"ion-title",4),e.EFF(8,"Completar registro"),e.k0s()()(),e.j41(9,"ion-grid",5)(10,"ion-row",6)(11,"ion-col",7)(12,"form",8),e.bIt("ngSubmit",function(){return e.eBV(a),e.Njj(n.completarRegistro())}),e.nrm(13,"br")(14,"ion-input",9)(15,"br")(16,"ion-input",10)(17,"br")(18,"ion-input",11)(19,"br"),e.j41(20,"input",12,0),e.bIt("change",function(){e.eBV(a);const c=e.sdS(21);return e.Njj(n.viewPreview(c))}),e.k0s(),e.j41(22,"ion-list",13)(23,"ion-item",14)(24,"ion-label"),e.EFF(25,"Selecciona una foto de perfil"),e.k0s(),e.j41(26,"ion-buttons",15)(27,"ion-button",16),e.bIt("click",function(){e.eBV(a);const c=e.sdS(21);return e.Njj(c.click())}),e.nrm(28,"ion-icon",17),e.k0s()()()(),e.j41(29,"div",18),e.DNE(30,ae,5,0,"span",19),e.k0s(),e.nrm(31,"br"),e.DNE(32,se,3,3,"div",20),e.nrm(33,"br"),e.j41(34,"div",20)(35,"ion-button",21),e.EFF(36," Completar registro "),e.k0s()()(),e.j41(37,"ion-card",22)(38,"ion-item",23),e.bIt("click",function(){return e.eBV(a),e.Njj(n.salir())}),e.nrm(39,"ion-icon",24),e.j41(40,"ion-label"),e.EFF(41,"Cerrar sesi\xf3n"),e.k0s()()()()()()()}2&t&&(e.R7$(12),e.Y8G("formGroup",n.datosFormCompleteRegistro),e.R7$(18),e.Y8G("ngIf",n.datosFormCompleteRegistro.controls.photo.hasError("required")),e.R7$(2),e.vxM(null!=n.datosFormCompleteRegistro&&null!=n.datosFormCompleteRegistro.controls&&null!=n.datosFormCompleteRegistro.controls.photo&&n.datosFormCompleteRegistro.controls.photo.value?32:-1))},dependencies:[g.bT,s.qT,s.BC,s.cb,s.j4,s.JD,r.W9,r.eU,r.ai,r.BC,r.uz,r.he,r.b_,r.QW,r.nf,r.Jm,r.lO,r.ln,r.hU,r.$w,r.iq,y.R],styles:["span[_ngcontent-%COMP%]{color:red}img[_ngcontent-%COMP%]{max-width:100px;border-radius:100%}"]})}return i})();var ce=d(6114);let ue=(()=>{class i{constructor(o,t,n,a){this.route=o,this.router=t,this.interactionService=n,this.menuController=a,this.authenticationService=(0,e.WQX)(b.k),this.firestoreService=(0,e.WQX)(F.B),this.userService=(0,e.WQX)(S.D),this.getQueryParams(),this.getTokenOfProvider(),this.userService.validateHasProfile=!1,this.menuController.enable(!1,"main")}ngOnInit(){}getQueryParams(){var o=this;return(0,m.A)(function*(){const t=o.route.snapshot.queryParams;if(console.log("queryParams -> ",t),t.provider&&t.intentId){const n=t.provider;yield o.interactionService.showLoading("Procesando..."),o.authenticationService.loginWithProvider(n),o.router.navigate(["/user/request-login"],{queryParams:{intentId:t.intentId}})}})()}getTokenOfProvider(){var o=this;return(0,m.A)(function*(){yield o.interactionService.showLoading("Redirigiendo...");const t=yield o.authenticationService.getRedirectResult();if(console.log("getRedirectResult -> ",t),t){const n=ce.LD.credentialFromResult(t);console.log("credential -> ",n),o.saveToken(n.idToken?n.idToken:n.accessToken)}else o.interactionService.dismissLoading()})()}saveToken(o){var t=this;return(0,m.A)(function*(){const a=t.route.snapshot.queryParams.intentId;if(a){const u=f.B.Auth.PathIntentsLogin,c={token:o};yield t.firestoreService.updateDocument(`${u}/${a}`,c),t.authenticationService.logout(),console.log("guardado token con \xe9xito")}})()}static#e=this.\u0275fac=function(t){return new(t||i)(e.rXU(p.nX),e.rXU(p.Ix),e.rXU(C.y),e.rXU(r._t))};static#o=this.\u0275cmp=e.VBU({type:i,selectors:[["app-request-login"]],decls:0,vars:0,template:function(t,n){}})}return i})();var w=d(5597);let me=(()=>{class i{constructor(){this.functions=(0,e.WQX)(w.ah)}call(o,t=null){return(0,w.Qg)(this.functions,o)(t)}static#e=this.\u0275fac=function(t){return new(t||i)};static#o=this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function de(i,l){if(1&i&&(e.nrm(0,"img",1),e.nI1(1,"reftourl"),e.nI1(2,"async")),2&i){const o=e.XpG(2);e.Y8G("src",e.bMT(2,3,e.bMT(1,1,o.user.photo)),e.B4B)}}function pe(i,l){1&i&&e.nrm(0,"img",2)}function _e(i,l){if(1&i&&(e.j41(0,"ion-select-option",4),e.EFF(1),e.k0s()),2&i){const o=l.$implicit;e.Y8G("value",o),e.R7$(),e.JRh(o)}}function fe(i,l){if(1&i){const o=e.RV6();e.j41(0,"ion-item")(1,"ion-avatar",0),e.DNE(2,de,3,5,"img",1)(3,pe,1,0,"img",2),e.k0s(),e.j41(4,"ion-label")(5,"strong"),e.EFF(6,"Nombre:"),e.k0s(),e.EFF(7),e.j41(8,"p")(9,"strong"),e.EFF(10,"Email:"),e.k0s(),e.EFF(11),e.k0s(),e.j41(12,"p")(13,"strong"),e.EFF(14,"Edad:"),e.k0s(),e.EFF(15),e.k0s()()(),e.j41(16,"ion-item")(17,"ion-select",3),e.bIt("ionChange",function(n){e.eBV(o);const a=e.XpG();return e.Njj(a.changeRol(n))}),e.mxI("ngModelChange",function(n){e.eBV(o);const a=e.XpG();return e.DH7(a.rolesSelect,n)||(a.rolesSelect=n),e.Njj(n)}),e.Z7z(18,_e,2,2,"ion-select-option",4,e.Vm6),e.k0s()()}if(2&i){const o=e.XpG();e.R7$(2),e.vxM(o.user.photo?2:3),e.R7$(5),e.SpI(" ",o.user.name," "),e.R7$(4),e.SpI(" ",o.user.email,""),e.R7$(4),e.SpI(" ",o.user.age,""),e.R7$(2),e.R50("ngModel",o.rolesSelect),e.R7$(),e.Dyx(o.roles)}}let ge=(()=>{class i{constructor(o){this.interactionService=o,this.functionsService=(0,e.WQX)(me),this.roles=["admin","cliente","motorizado"],this.rolesSelect=[]}ngOnInit(){this.initRoles()}initRoles(){for(const o in this.user.roles)this.rolesSelect.push(o);console.log("this.rolesSelect -> ",this.rolesSelect)}changeRol(o){var t=this;return(0,m.A)(function*(){console.log("changeRol -> ",o.detail.value),yield t.interactionService.showLoading("Actualizando...");const n={};t.rolesSelect.forEach(c=>{n[c]=!0}),console.log("updateDoc roles -> ",{roles:n});const u={roles:n,uid:t.user.id};try{const c=yield t.functionsService.call("setRol",u);t.interactionService.dismissLoading(),t.interactionService.showToast("Rol actualizado con \xe9xito"),console.log("response -> ",c)}catch(c){t.interactionService.dismissLoading(),t.interactionService.presentAlert("Error","No se pudo actualizar el rol del usuario"),console.log("changeRol error -> ",c)}})()}static#e=this.\u0275fac=function(t){return new(t||i)(e.rXU(C.y))};static#o=this.\u0275cmp=e.VBU({type:i,selectors:[["app-user-detail"]],inputs:{user:"user"},decls:1,vars:1,consts:[["slot","start"],[3,"src"],["src","https://i.pinimg.com/736x/0d/64/98/0d64989794b1a4c9d89bff571d3d5842.jpg"],["label","Rol","label-placement","floating","multiple","",3,"ionChange","ngModelChange","ngModel"],[3,"value"]],template:function(t,n){1&t&&e.DNE(0,fe,20,5),2&t&&e.vxM(n.user?0:-1)},dependencies:[s.BC,s.vS,r.uz,r.mC,r.he,r.Nm,r.Ip,g.Jj,E.g]})}return i})();function he(i,l){if(1&i&&(e.j41(0,"ion-segment-button",12)(1,"ion-label"),e.EFF(2),e.k0s()()),2&i){const o=l.$implicit;e.Y8G("value",o),e.R7$(2),e.JRh(o)}}function ve(i,l){if(1&i){const o=e.RV6();e.j41(0,"ion-grid",7)(1,"ion-row",9)(2,"ion-col",10)(3,"ion-segment",11),e.mxI("ngModelChange",function(n){e.eBV(o);const a=e.XpG();return e.DH7(a.rolSegment,n)||(a.rolSegment=n),e.Njj(n)}),e.bIt("ionChange",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.getMoreUsers(n.rolSegment))}),e.Z7z(4,he,3,2,"ion-segment-button",12,e.Vm6),e.k0s()()()()}if(2&i){const o=e.XpG();e.R7$(3),e.R50("ngModel",o.rolSegment),e.R7$(),e.Dyx(o.roles)}}function Ce(i,l){if(1&i&&(e.j41(0,"ion-list",13),e.nrm(1,"app-user-detail",17),e.k0s()),2&i){const o=l.$implicit;e.R7$(),e.Y8G("user",o)}}function be(i,l){1&i&&(e.j41(0,"div",14)(1,"p"),e.EFF(2,"no hay usuarios "),e.k0s()())}function Fe(i,l){if(1&i){const o=e.RV6();e.Z7z(0,Ce,2,1,"ion-list",13,e.Vm6,!1,be,3,0,"div",14),e.j41(3,"ion-infinite-scroll",15),e.bIt("ionInfinite",function(n){e.eBV(o);const a=e.XpG();return e.Njj(a.loadData(n))}),e.nrm(4,"ion-infinite-scroll-content",16),e.k0s()}if(2&i){const o=e.XpG();e.Dyx(o.users),e.R7$(3),e.Y8G("disabled",!o.enableMore)}}function ke(i,l){1&i&&(e.nrm(0,"br"),e.j41(1,"div",18),e.nrm(2,"ion-spinner",19),e.k0s())}let je=(()=>{class i{constructor(o){this.fb=o,this.firestoreService=(0,e.WQX)(F.B),this.roles=["admin","cliente","motorizado"],this.rolSelected="admin",this.cargando=!0,this.enableMore=!1,this.enableBuscarPorEmail=!1,this.formEmail=this.fb.group({email:["",[s.k0.required,s.k0.email]]}),this.rolSegment="admin",this.numItems=4,this.getMoreUsers()}ngOnInit(){}getMoreUsers(o=this.rolSelected){var t=this;return(0,m.A)(function*(){console.log(" getMoreUsers -> ",t.rolSegment),t.rolSelected!=o&&(t.users=null,t.cargando=!0,t.enableMore=!0),t.rolSelected=o,console.log("getMoreUsers");const n=f.B.Auth.PathUsers,a=t.numItems;let u;u=[[`roles.${o}`,"==",!0]];const c={orderParam:"date",directionSort:"desc",limit:a};if(t.users){const h=t.users[t.users.length-1],v=yield t.firestoreService.getDocument(`${n}/${h.id}`);c.startAfter=v}const _=yield t.firestoreService.getDocumentsQuery(n,u,c);t.cargando=!1,console.log("res -> ",_),_.size?(_.size<a&&(t.enableMore=!1),t.users||(t.users=[]),_.forEach(h=>{t.users.push(h.data())})):t.enableMore=!1})()}loadData(o){var t=this;return(0,m.A)(function*(){console.log("loadData"),yield t.getMoreUsers(),o.target.complete()})()}onSearchChange(o){var t=this;return(0,m.A)(function*(){t.enableBuscarPorEmail=!0,console.log("onSearchChange -> ",o);const n=o.detail.value;t.users=null,t.cargando=!0,t.enableMore=!1;const a=f.B.Auth.PathUsers;let u;u=[["email","==",n]];const c=yield t.firestoreService.getDocumentsQuery(a,u);t.cargando=!1,c.empty||c.forEach(_=>{t.users=[],t.users.push(_.data())})})()}cancelSearch(){setTimeout(()=>{this.enableBuscarPorEmail=!1,this.getMoreUsers()},200)}static#e=this.\u0275fac=function(t){return new(t||i)(e.rXU(s.ok))};static#o=this.\u0275cmp=e.VBU({type:i,selectors:[["app-users"]],decls:15,vars:2,consts:[["translucent","true"],["slot","start"],["defaultHref","/"],["fullscreen","true","color","light"],["collapse","condense"],["size","large"],["placeholder","Correo","type","email","mode","ios","showCancelButton","always","cancelButtonText","cancelar","animated","true",3,"ionChange","ionCancel"],["fixed",""],["threshold","25%","position","bottom",3,"disabled"],[1,"ion-justify-content-center"],["size","11","size-md","8","size-xl","6"],[3,"ngModelChange","ionChange","ngModel"],[3,"value"],["inset",""],[2,"text-align","center"],["threshold","25%","position","bottom",3,"ionInfinite","disabled"],["loadingSpinner","bubbles"],[3,"user"],[1,"ion-text-center"],["name","bubbles"]],template:function(t,n){1&t&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Usuarios"),e.k0s(),e.j41(4,"ion-buttons",1),e.nrm(5,"ion-back-button",2),e.k0s()()(),e.j41(6,"ion-content",3)(7,"ion-header",4)(8,"ion-toolbar")(9,"ion-title",5),e.EFF(10,"Usuarios"),e.k0s()()(),e.j41(11,"ion-searchbar",6),e.bIt("ionChange",function(u){return n.onSearchChange(u)})("ionCancel",function(){return n.cancelSearch()}),e.k0s(),e.DNE(12,ve,6,1,"ion-grid",7)(13,Fe,5,2,"ion-infinite-scroll",8)(14,ke,3,0),e.k0s()),2&t&&(e.R7$(12),e.vxM(n.enableBuscarPorEmail?-1:12),e.R7$(),e.vxM(n.cargando?14:13))},dependencies:[s.BC,s.vS,r.W9,r.eU,r.ai,r.BC,r.he,r.el,r.QW,r.nf,r.lO,r.ln,r.hU,r.w2,r.Gp,r.eP,r.Ax,r.Hp,r.S1,ge]})}return i})();var k=d(8031);const Se=[{path:"login",component:M,canActivate:[k.D.notLogin("/user/perfil")]},{path:"request-login",component:ue},{path:"registro",component:A,canActivate:[k.D.notLogin("/user/perfil")]},{path:"completar-registro",component:le,canActivate:[k.D.isLogin()]},{path:"perfil",component:re,canActivate:[k.D.isLogin()]},{path:"admin",component:je,canActivate:[k.D.isRolClaim(["admin"])]}];let ye=(()=>{class i{static#e=this.\u0275fac=function(t){return new(t||i)};static#o=this.\u0275mod=e.$C({type:i});static#t=this.\u0275inj=e.G2t({imports:[p.iI.forChild(Se),p.iI]})}return i})();var Pe=d(3887);let Ee=(()=>{class i{static#e=this.\u0275fac=function(t){return new(t||i)};static#o=this.\u0275mod=e.$C({type:i});static#t=this.\u0275inj=e.G2t({imports:[g.MD,ye,s.YN,s.X1,Pe.G,r.W9,r.eU,r.ai,r.BC,r.uz,r.mC,r.he,r.b_,r.el,r.QW,r.MC,r.el,r.nf,r.uz,r.Jm,r.Sb,r.lO,r.ln,r.hU,r.$w,r.Wv,r.b_,r.IO,r.ZB,r.iq,r.w2,r.AF,r.nf,r.M0,r.Gp,r.eP,r.Nm,r.Ip,r.Ax,r.Hp,r.S1]})}return i})()}}]);